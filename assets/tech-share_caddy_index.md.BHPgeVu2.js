import{_ as s,o as i,c as n,a2 as l}from"./chunks/framework.C766EroN.js";const k=JSON.parse('{"title":"Caddy 助力前后端分离项目快速部署","description":"基于 Caddy 快速部署前后端分离项目（纯 HTTP 外网访问）","frontmatter":{"title":"Caddy 助力前后端分离项目快速部署","description":"基于 Caddy 快速部署前后端分离项目（纯 HTTP 外网访问）"},"headers":[],"relativePath":"tech-share/caddy/index.md","filePath":"tech-share/caddy/index.md"}'),e={name:"tech-share/caddy/index.md"};function t(p,a,h,d,r,o){return i(),n("div",null,[...a[0]||(a[0]=[l(`<blockquote><p>编辑日期：2026-02-26</p></blockquote><h1 id="caddy-助力前后端分离项目快速部署" tabindex="-1">Caddy 助力前后端分离项目快速部署 <a class="header-anchor" href="#caddy-助力前后端分离项目快速部署" aria-label="Permalink to &quot;Caddy 助力前后端分离项目快速部署&quot;">​</a></h1><p>基于 Caddy 快速部署前后端分离项目（纯 HTTP 外网访问）技术实践文档。</p><h2 id="一、文档概述" tabindex="-1">一、文档概述 <a class="header-anchor" href="#一、文档概述" aria-label="Permalink to &quot;一、文档概述&quot;">​</a></h2><p>本文档为前后端分离项目（Vue/H5 前端）生产环境部署实践，使用 Caddy 2 作为静态资源 Web 服务器，实现多站点、多端口、跨域、路由刷新兼容、外网可访问的完整部署方案。</p><ul><li><strong>适用场景</strong>：管理后台 + 移动端 H5 同时部署</li><li><strong>协议</strong>：HTTP（无 HTTPS）</li><li><strong>服务器</strong>：Linux CentOS</li><li><strong>目标</strong>：极简配置、稳定运行、快速排错</li></ul><h2 id="二、架构与需求" tabindex="-1">二、架构与需求 <a class="header-anchor" href="#二、架构与需求" aria-label="Permalink to &quot;二、架构与需求&quot;">​</a></h2><h3 id="_1-项目结构" tabindex="-1">1. 项目结构 <a class="header-anchor" href="#_1-项目结构" aria-label="Permalink to &quot;1. 项目结构&quot;">​</a></h3><ul><li>管理后台：lyedu-admin（Vue 打包 dist）</li><li>移动端 H5：lyedu-h5</li><li>分别使用独立端口：9900 / 9901</li></ul><h3 id="_2-核心需求" tabindex="-1">2. 核心需求 <a class="header-anchor" href="#_2-核心需求" aria-label="Permalink to &quot;2. 核心需求&quot;">​</a></h3><ol><li>外网可通过 <code>http://IP:端口</code> 直接访问</li><li>解决 Vue Router 刷新 404</li><li>支持跨域</li><li>启用 Gzip 压缩</li><li>不占用 80/443，避免端口冲突</li><li>稳定后台运行</li></ol><h2 id="三、caddy-核心优势-为什么选-caddy" tabindex="-1">三、Caddy 核心优势（为什么选 Caddy） <a class="header-anchor" href="#三、caddy-核心优势-为什么选-caddy" aria-label="Permalink to &quot;三、Caddy 核心优势（为什么选 Caddy）&quot;">​</a></h2><ol><li>单二进制文件，无需依赖</li><li>Caddyfile 语法极简，易维护</li><li>自动静态服务、自动压缩</li><li>原生支持 try_files，完美适配 SPA</li><li>可灵活关闭自动 HTTPS，避免端口抢占</li><li>内存占用低，适合小带宽服务器</li></ol><h2 id="四、最终可用-caddy-完整配置" tabindex="-1">四、最终可用 Caddy 完整配置 <a class="header-anchor" href="#四、最终可用-caddy-完整配置" aria-label="Permalink to &quot;四、最终可用 Caddy 完整配置&quot;">​</a></h2><p><strong>路径</strong>：<code>/app/caddy/Caddyfile</code></p><div class="language-caddyfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">caddyfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>    log {</span></span>
<span class="line"><span>        level warn</span></span>
<span class="line"><span>        output file /var/log/caddy/caddy.log {</span></span>
<span class="line"><span>            roll_size 100MB    # 单个日志文件大小阈值</span></span>
<span class="line"><span>            roll_keep 7        # 保留最近 7 天日志</span></span>
<span class="line"><span>            roll_keep_for 30d  # 日志最长保留 30 天</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    auto_https off</span></span>
<span class="line"><span>    admin off</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 管理后台 9900</span></span>
<span class="line"><span>:9900 {</span></span>
<span class="line"><span>    bind 0.0.0.0</span></span>
<span class="line"><span>    root * /app/ly-edu/lyedu-admin/dist</span></span>
<span class="line"><span>    encode gzip</span></span>
<span class="line"><span>    file_server</span></span>
<span class="line"><span>    try_files {path} /index.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    header {</span></span>
<span class="line"><span>        Access-Control-Allow-Origin *</span></span>
<span class="line"><span>        Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS</span></span>
<span class="line"><span>        Access-Control-Allow-Headers Content-Type,Authorization</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># H5 移动端 9901</span></span>
<span class="line"><span>:9901 {</span></span>
<span class="line"><span>    bind 0.0.0.0</span></span>
<span class="line"><span>    root * /app/ly-edu/lyedu-h5</span></span>
<span class="line"><span>    encode gzip</span></span>
<span class="line"><span>    file_server</span></span>
<span class="line"><span>    try_files {path} /index.html</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    header {</span></span>
<span class="line"><span>        Access-Control-Allow-Origin *</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p><strong>路径说明</strong>：若实际项目根目录无 <code>/app/ly-edu/</code> 层级（直接为 <code>/app/lyedu-admin/</code>），请将配置中 root 路径改为 <code>/app/lyedu-admin/dist</code> 和 <code>/app/lyedu-h5</code>。</p><h2 id="五、部署流程-标准运维步骤" tabindex="-1">五、部署流程（标准运维步骤） <a class="header-anchor" href="#五、部署流程-标准运维步骤" aria-label="Permalink to &quot;五、部署流程（标准运维步骤）&quot;">​</a></h2><h3 id="_1-格式化配置-规范语法" tabindex="-1">1. 格式化配置（规范语法） <a class="header-anchor" href="#_1-格式化配置-规范语法" aria-label="Permalink to &quot;1. 格式化配置（规范语法）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fmt</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --overwrite</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/caddy/Caddyfile</span></span></code></pre></div><h3 id="_2-创建日志目录-若使用按日期拆分日志" tabindex="-1">2. 创建日志目录（若使用按日期拆分日志） <a class="header-anchor" href="#_2-创建日志目录-若使用按日期拆分日志" aria-label="Permalink to &quot;2. 创建日志目录（若使用按日期拆分日志）&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/caddy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/caddy</span></span></code></pre></div><h3 id="_3-验证配置语法" tabindex="-1">3. 验证配置语法 <a class="header-anchor" href="#_3-验证配置语法" aria-label="Permalink to &quot;3. 验证配置语法&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> validate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/caddy/Caddyfile</span></span></code></pre></div><h3 id="_4-启动方式" tabindex="-1">4. 启动方式 <a class="header-anchor" href="#_4-启动方式" aria-label="Permalink to &quot;4. 启动方式&quot;">​</a></h3><p><strong>前台启动（调试用）</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/caddy/Caddyfile</span></span></code></pre></div><p><strong>后台守护启动（生产推荐）</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/caddy/Caddyfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> caddy.log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span></code></pre></div><h3 id="_5-停止服务" tabindex="-1">5. 停止服务 <a class="header-anchor" href="#_5-停止服务" aria-label="Permalink to &quot;5. 停止服务&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span></span></code></pre></div><h3 id="_6-查看运行日志" tabindex="-1">6. 查看运行日志 <a class="header-anchor" href="#_6-查看运行日志" aria-label="Permalink to &quot;6. 查看运行日志&quot;">​</a></h3><p>使用按日期拆分配置时，日志写入 <code>/var/log/caddy/</code>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/caddy/caddy.log</span></span></code></pre></div><h2 id="六、网络安全配置-外网访问必须" tabindex="-1">六、网络安全配置（外网访问必须） <a class="header-anchor" href="#六、网络安全配置-外网访问必须" aria-label="Permalink to &quot;六、网络安全配置（外网访问必须）&quot;">​</a></h2><h3 id="_1-防火墙开放端口" tabindex="-1">1. 防火墙开放端口 <a class="header-anchor" href="#_1-防火墙开放端口" aria-label="Permalink to &quot;1. 防火墙开放端口&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=9900/tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=9901/tcp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre></div><h3 id="_2-云服务器安全组" tabindex="-1">2. 云服务器安全组 <a class="header-anchor" href="#_2-云服务器安全组" aria-label="Permalink to &quot;2. 云服务器安全组&quot;">​</a></h3><p>入方向放行：</p><ul><li>端口：9900、9901</li><li>协议：TCP</li><li>授权：0.0.0.0/0</li></ul><h2 id="七、访问规则" tabindex="-1">七、访问规则 <a class="header-anchor" href="#七、访问规则" aria-label="Permalink to &quot;七、访问规则&quot;">​</a></h2><table tabindex="0"><thead><tr><th>应用</th><th>地址</th></tr></thead><tbody><tr><td>管理后台</td><td><a href="http://xn--IP-xz4cq45o:9900" target="_blank" rel="noreferrer">http://公网IP:9900</a></td></tr><tr><td>H5 移动端</td><td><a href="http://xn--IP-xz4cq45o:9901" target="_blank" rel="noreferrer">http://公网IP:9901</a></td></tr></tbody></table><p><strong>强制规则</strong>：</p><ul><li>必须使用 <code>http://</code></li><li>必须带端口</li><li>禁止使用 <code>https://</code></li></ul><h2 id="八、高频问题与解决方案-实战总结" tabindex="-1">八、高频问题与解决方案（实战总结） <a class="header-anchor" href="#八、高频问题与解决方案-实战总结" aria-label="Permalink to &quot;八、高频问题与解决方案（实战总结）&quot;">​</a></h2><h3 id="问题-1-启动报错-80-端口被占用" tabindex="-1">问题 1：启动报错 80 端口被占用 <a class="header-anchor" href="#问题-1-启动报错-80-端口被占用" aria-label="Permalink to &quot;问题 1：启动报错 80 端口被占用&quot;">​</a></h3><ul><li><strong>原因</strong>：Caddy 默认自动开启 HTTPS</li><li><strong>解决</strong>：<code>auto_https off</code></li></ul><h3 id="问题-2-浏览器提示-client-sent-an-http-request-to-an-https-server" tabindex="-1">问题 2：浏览器提示 Client sent an HTTP request to an HTTPS server <a class="header-anchor" href="#问题-2-浏览器提示-client-sent-an-http-request-to-an-https-server" aria-label="Permalink to &quot;问题 2：浏览器提示 Client sent an HTTP request to an HTTPS server&quot;">​</a></h3><ul><li><strong>原因</strong>：用 https 访问 http 端口</li><li><strong>解决</strong>：必须使用 <code>http://IP:端口</code></li></ul><h3 id="问题-3-访问返回-404" tabindex="-1">问题 3：访问返回 404 <a class="header-anchor" href="#问题-3-访问返回-404" aria-label="Permalink to &quot;问题 3：访问返回 404&quot;">​</a></h3><ul><li>目录路径错误（重点检查 lyedu-admin/lyedu-h5 拼写）</li><li>dist 目录不存在</li><li>缺少 index.html</li><li>权限不足</li></ul><p><strong>排查命令</strong>：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查管理后台目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ld</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/ly-edu/lyedu-admin/dist</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/ly-edu/lyedu-admin/dist/index.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查H5目录</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ld</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/ly-edu/lyedu-h5</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/ly-edu/lyedu-h5/index.html</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修复权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/ly-edu/</span></span></code></pre></div><h3 id="问题-4-本地-curl-正常-外网无法访问" tabindex="-1">问题 4：本地 curl 正常，外网无法访问 <a class="header-anchor" href="#问题-4-本地-curl-正常-外网无法访问" aria-label="Permalink to &quot;问题 4：本地 curl 正常，外网无法访问&quot;">​</a></h3><ul><li>公网 IP 错误</li><li>安全组未放行端口</li><li>防火墙未开放端口</li></ul><h2 id="九、服务状态检查-运维必备" tabindex="-1">九、服务状态检查（运维必备） <a class="header-anchor" href="#九、服务状态检查-运维必备" aria-label="Permalink to &quot;九、服务状态检查（运维必备）&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看端口监听</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">netstat</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tulpn</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> caddy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 本地接口检测</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:9900</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -I</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://127.0.0.1:9901</span></span></code></pre></div><h2 id="十、总结-技术亮点" tabindex="-1">十、总结（技术亮点） <a class="header-anchor" href="#十、总结-技术亮点" aria-label="Permalink to &quot;十、总结（技术亮点）&quot;">​</a></h2><ol><li>一套配置支撑多前端应用</li><li>完美适配 Vue/React 等 SPA 路由</li><li>跨域、压缩、静态服务一键完成</li><li>无 80/443 依赖，避免冲突</li><li>日志清晰、排错成本极低</li><li>适合前后端分离项目快速上线</li></ol><h2 id="补充说明" tabindex="-1">补充说明 <a class="header-anchor" href="#补充说明" aria-label="Permalink to &quot;补充说明&quot;">​</a></h2><p>若实际部署时，lyedu-admin/lyedu-h5 存放路径无 <code>/app/ly-edu/</code> 父目录（例如直接在 <code>/app/</code> 下），需将 Caddyfile 中 root 配置修改为：</p><div class="language-caddyfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">caddyfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 管理后台路径</span></span>
<span class="line"><span>root * /app/lyedu-admin/dist</span></span>
<span class="line"><span></span></span>
<span class="line"><span># H5路径</span></span>
<span class="line"><span>root * /app/lyedu-h5</span></span></code></pre></div><p>修改后需重新执行「验证配置」和「重启 Caddy」步骤。</p>`,63)])])}const g=s(e,[["render",t]]);export{k as __pageData,g as default};
