import{_ as s,o as i,c as n,a2 as l}from"./chunks/framework.C766EroN.js";const k=JSON.parse('{"title":"Caddy 实现日志按日期拆分","description":"Caddy 日志按日期拆分配置与实践","frontmatter":{"title":"Caddy 实现日志按日期拆分","description":"Caddy 日志按日期拆分配置与实践"},"headers":[],"relativePath":"tech-share/caddy/log-split.md","filePath":"tech-share/caddy/log-split.md"}'),p={name:"tech-share/caddy/log-split.md"};function e(d,a,t,h,o,c){return i(),n("div",null,[...a[0]||(a[0]=[l(`<blockquote><p>编辑日期：2026-02-26</p></blockquote><h1 id="caddy-实现日志按日期拆分" tabindex="-1">Caddy 实现日志按日期拆分 <a class="header-anchor" href="#caddy-实现日志按日期拆分" aria-label="Permalink to &quot;Caddy 实现日志按日期拆分&quot;">​</a></h1><p>本文档介绍如何配置 Caddy，实现日志按日期自动拆分，便于归档与排查。</p><h2 id="一、默认行为说明" tabindex="-1">一、默认行为说明 <a class="header-anchor" href="#一、默认行为说明" aria-label="Permalink to &quot;一、默认行为说明&quot;">​</a></h2><p>默认情况下，Caddy 日志不会自动按日期拆分，日志会持续写入同一个文件（如 <code>nohup</code> 命令配置的 <code>caddy.log</code>），不会自动按天/按小时分割。</p><p><strong>当前配置（<code>level warn</code>）</strong>：仅输出警告及以上日志，默认写入启动时指定的文件，无日期拆分。</p><h2 id="二、如何实现日志按日期拆分" tabindex="-1">二、如何实现日志按日期拆分？ <a class="header-anchor" href="#二、如何实现日志按日期拆分" aria-label="Permalink to &quot;二、如何实现日志按日期拆分？&quot;">​</a></h2><p>需手动配置日志的 <code>roll</code> 选项（<strong>Caddy 2.6+</strong> 支持），在 Caddyfile 全局块中修改 <code>log</code> 配置即可：</p><div class="language-caddyfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">caddyfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>    log {</span></span>
<span class="line"><span>        level warn</span></span>
<span class="line"><span>        output file /var/log/caddy/caddy.log {</span></span>
<span class="line"><span>            roll_size 100MB    # 单个日志文件大小阈值</span></span>
<span class="line"><span>            roll_keep 7        # 保留最近 7 天日志</span></span>
<span class="line"><span>            roll_keep_for 30d  # 日志最长保留 30 天</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    auto_https off</span></span>
<span class="line"><span>    admin off</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>配置后，日志会自动按日期命名（如 <code>caddy-2026-02-26.log</code>），自动拆分、自动清理，无需手动维护。</p><h2 id="三、注意事项" tabindex="-1">三、注意事项 <a class="header-anchor" href="#三、注意事项" aria-label="Permalink to &quot;三、注意事项&quot;">​</a></h2><ol><li><p><strong>目录与权限</strong>：需确保 <code>/var/log/caddy/</code> 目录存在且 Caddy 有权限写入：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/caddy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/log/caddy</span></span></code></pre></div></li><li><p><strong>验证与重启</strong>：修改配置后，需执行验证并重启 Caddy 生效：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> validate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/caddy/Caddyfile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nohup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./caddy</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /app/caddy/Caddyfile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> 2&gt;&amp;1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span></span></code></pre></div></li><li><p><strong>版本要求</strong>：若 Caddy 版本低于 2.6，不支持 <code>roll</code> 选项，需借助外部工具（如 <code>logrotate</code>）实现日志按日期拆分。</p></li></ol>`,12)])])}const g=s(p,[["render",e]]);export{k as __pageData,g as default};
