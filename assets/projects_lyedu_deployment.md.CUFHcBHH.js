import{_ as s,o as n,c as e,a2 as l}from"./chunks/framework.C766EroN.js";const k=JSON.parse('{"title":"LyEdu 部署指南","description":"","frontmatter":{},"headers":[],"relativePath":"projects/lyedu/deployment.md","filePath":"projects/lyedu/deployment.md"}'),i={name:"projects/lyedu/deployment.md"};function t(p,a,o,r,h,d){return n(),e("div",null,[...a[0]||(a[0]=[l(`<h1 id="lyedu-部署指南" tabindex="-1">LyEdu 部署指南 <a class="header-anchor" href="#lyedu-部署指南" aria-label="Permalink to &quot;LyEdu 部署指南&quot;">​</a></h1><blockquote><p>编辑日期：2026-02-26<br> 基于 <a href="https://gitee.com/quxiangshun/ly-edu" target="_blank" rel="noreferrer">ly-edu</a> 项目结构整理</p></blockquote><h2 id="一、部署方式概览" tabindex="-1">一、部署方式概览 <a class="header-anchor" href="#一、部署方式概览" aria-label="Permalink to &quot;一、部署方式概览&quot;">​</a></h2><table tabindex="0"><thead><tr><th>方式</th><th>适用场景</th><th>说明</th></tr></thead><tbody><tr><td>Docker Compose</td><td>快速部署、中小规模</td><td>单机多容器，当前默认使用 Java 后端</td></tr><tr><td>Kubernetes</td><td>生产、高可用</td><td>需自行编写 K8s 清单</td></tr><tr><td>手动部署</td><td>定制化强</td><td>按模块分别部署前后端与数据库</td></tr></tbody></table><h2 id="二、docker-compose-部署" tabindex="-1">二、Docker Compose 部署 <a class="header-anchor" href="#二、docker-compose-部署" aria-label="Permalink to &quot;二、Docker Compose 部署&quot;">​</a></h2><h3 id="环境要求" tabindex="-1">环境要求 <a class="header-anchor" href="#环境要求" aria-label="Permalink to &quot;环境要求&quot;">​</a></h3><ul><li>Docker 20.10+</li><li>Docker Compose 1.29+</li><li>可用内存 4GB+</li></ul><h3 id="当前-docker-方案-java-后端" tabindex="-1">当前 Docker 方案（Java 后端） <a class="header-anchor" href="#当前-docker-方案-java-后端" aria-label="Permalink to &quot;当前 Docker 方案（Java 后端）&quot;">​</a></h3><p>Docker 默认使用 <strong>Java</strong> 后端，需先本地构建 jar。</p><h4 id="_1-构建-jar" tabindex="-1">1. 构建 jar <a class="header-anchor" href="#_1-构建-jar" aria-label="Permalink to &quot;1. 构建 jar&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lyedu-api</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">build-api.ps1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   # Windows</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或 ./build-api.sh  # Linux / Mac</span></span></code></pre></div><p>产物输出到 <code>pkg/lyedu-api.jar</code>。</p><h4 id="_2-配置环境变量" tabindex="-1">2. 配置环境变量 <a class="header-anchor" href="#_2-配置环境变量" aria-label="Permalink to &quot;2. 配置环境变量&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.example</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre></div><p>编辑 <code>.env</code>，配置数据库密码、Redis、镜像源等。国内可配置：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">DOCKER_REGISTRY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">registry.cn-hangzhou.aliyuncs.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">NPM_REGISTRY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://registry.npmmirror.com</span></span></code></pre></div><h4 id="_3-构建与启动" tabindex="-1">3. 构建与启动 <a class="header-anchor" href="#_3-构建与启动" aria-label="Permalink to &quot;3. 构建与启动&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> scripts/docker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h4 id="_4-访问地址" tabindex="-1">4. 访问地址 <a class="header-anchor" href="#_4-访问地址" aria-label="Permalink to &quot;4. 访问地址&quot;">​</a></h4><ul><li>管理后台：<a href="http://localhost:9900" target="_blank" rel="noreferrer">http://localhost:9900</a></li><li>PC 端：<a href="http://localhost:9800" target="_blank" rel="noreferrer">http://localhost:9800</a></li><li>API：<a href="http://localhost:9700" target="_blank" rel="noreferrer">http://localhost:9700</a>（若使用 Python compose）或 8080（Java）</li></ul><h3 id="初始化与升级" tabindex="-1">初始化与升级 <a class="header-anchor" href="#初始化与升级" aria-label="Permalink to &quot;初始化与升级&quot;">​</a></h3><ul><li><strong>初始化数据</strong>：首次部署后，按 README 执行初始化命令（如 Java：<code>--spring.profiles.active=init</code>）</li><li><strong>数据库迁移</strong>：Java 使用 Flyway 自动迁移；Python 需执行 <code>alembic upgrade head</code></li></ul><h2 id="三、生产部署" tabindex="-1">三、生产部署 <a class="header-anchor" href="#三、生产部署" aria-label="Permalink to &quot;三、生产部署&quot;">​</a></h2><h3 id="_1-资源规划" tabindex="-1">1. 资源规划 <a class="header-anchor" href="#_1-资源规划" aria-label="Permalink to &quot;1. 资源规划&quot;">​</a></h3><ul><li><strong>CPU</strong>：建议 4 核+</li><li><strong>内存</strong>：8GB+，视并发调整</li><li><strong>存储</strong>：数据库 + 视频/文件，建议 50GB+</li></ul><h3 id="_2-部署" tabindex="-1">2. 部署 <a class="header-anchor" href="#_2-部署" aria-label="Permalink to &quot;2. 部署&quot;">​</a></h3><h4 id="_2-1-部署后端" tabindex="-1">2.1. 部署后端 <a class="header-anchor" href="#_2-1-部署后端" aria-label="Permalink to &quot;2.1. 部署后端&quot;">​</a></h4><ul><li>安装MySQL数据库数据；视频、附件、图片存储到本地</li><li></li><li>创建<code>/app/ly-edu</code> 文件夹，拷贝</li></ul><div class="language-caddyfile vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">caddyfile</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># 全局配置</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    # 关闭冗余日志，只保留警告及以上</span></span>
<span class="line"><span>    log {</span></span>
<span class="line"><span>        level warn</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    # 禁用自动HTTPS（避免Caddy自动监听443/80端口，彻底杜绝HTTP/HTTPS混淆）</span></span>
<span class="line"><span>    auto_https off</span></span>
<span class="line"><span>    # 关闭admin接口（减少端口占用，非必需）</span></span>
<span class="line"><span>    admin off</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 配置1：ly-edu-admin 后台管理（9900端口，纯HTTP）</span></span>
<span class="line"><span>:9900 {</span></span>
<span class="line"><span>    # 显式绑定所有网卡（解决WARN提示）</span></span>
<span class="line"><span>    bind 0.0.0.0</span></span>
<span class="line"><span>    # 前端代码目录（确保路径正确）</span></span>
<span class="line"><span>    root * /app/ly-edu/lyedu-admin/dist</span></span>
<span class="line"><span>    # gzip压缩</span></span>
<span class="line"><span>    encode gzip</span></span>
<span class="line"><span>    # 静态文件服务</span></span>
<span class="line"><span>    file_server</span></span>
<span class="line"><span>    # 解决Vue/Router刷新404</span></span>
<span class="line"><span>    try_files {path} /index.html</span></span>
<span class="line"><span>    # 跨域配置</span></span>
<span class="line"><span>    header {</span></span>
<span class="line"><span>        Access-Control-Allow-Origin *</span></span>
<span class="line"><span>        Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS</span></span>
<span class="line"><span>        Access-Control-Allow-Headers Content-Type,Authorization</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 配置2：ly-edu-h5 移动端（9901端口，纯HTTP）</span></span>
<span class="line"><span>:9901 {</span></span>
<span class="line"><span>    bind 0.0.0.0</span></span>
<span class="line"><span>    root * /app/ly-edu/lyedu-h5</span></span>
<span class="line"><span>    encode gzip</span></span>
<span class="line"><span>    file_server</span></span>
<span class="line"><span>    try_files {path} /index.html</span></span>
<span class="line"><span>    header {</span></span>
<span class="line"><span>        Access-Control-Allow-Origin *</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>使用 Nginx / Caddy 反向代理，配置 HTTPS</li><li>仅开放 80/443，后端端口不直接暴露</li><li>配置防火墙与安全组</li></ul><h3 id="_4-备份" tabindex="-1">4. 备份 <a class="header-anchor" href="#_4-备份" aria-label="Permalink to &quot;4. 备份&quot;">​</a></h3><ul><li>定期备份 MySQL 数据</li><li>备份上传的文件目录</li></ul><h2 id="四、kubernetes-部署-规划" tabindex="-1">四、Kubernetes 部署（规划） <a class="header-anchor" href="#四、kubernetes-部署-规划" aria-label="Permalink to &quot;四、Kubernetes 部署（规划）&quot;">​</a></h2><p>生产环境可选用 Kubernetes。需准备：</p><ul><li>Deployment、Service、Ingress 等清单</li><li>ConfigMap / Secret 管理配置</li><li>持久化卷（PVC）用于数据库与文件</li></ul><p>具体清单可参考项目 <code>docs/</code> 或社区示例，后续可补充到本文档。</p><h2 id="五、常见部署问题" tabindex="-1">五、常见部署问题 <a class="header-anchor" href="#五、常见部署问题" aria-label="Permalink to &quot;五、常见部署问题&quot;">​</a></h2><h3 id="_1-端口冲突" tabindex="-1">1. 端口冲突 <a class="header-anchor" href="#_1-端口冲突" aria-label="Permalink to &quot;1. 端口冲突&quot;">​</a></h3><ul><li>检查 9700、9800、9900、3306、6379 等端口占用</li><li>修改 <code>docker-compose.yml</code> 或 <code>.env</code> 中的端口映射</li></ul><h3 id="_2-数据库连接失败" tabindex="-1">2. 数据库连接失败 <a class="header-anchor" href="#_2-数据库连接失败" aria-label="Permalink to &quot;2. 数据库连接失败&quot;">​</a></h3><ul><li>确认 MySQL 已启动且可从容器内访问</li><li>检查 <code>DATABASE_URL</code> / <code>application.yml</code> 中的主机、端口、用户、密码</li></ul><h3 id="_3-前端访问-404" tabindex="-1">3. 前端访问 404 <a class="header-anchor" href="#_3-前端访问-404" aria-label="Permalink to &quot;3. 前端访问 404&quot;">​</a></h3><ul><li>确认 Nginx/Caddy 配置了 SPA 的 <code>try_files</code> 或 <code>fallback</code></li><li>检查 base URL 与 API 代理配置</li></ul><h3 id="_4-镜像构建慢" tabindex="-1">4. 镜像构建慢 <a class="header-anchor" href="#_4-镜像构建慢" aria-label="Permalink to &quot;4. 镜像构建慢&quot;">​</a></h3><ul><li>使用国内镜像源（<code>DOCKER_REGISTRY</code>、<code>NPM_REGISTRY</code>）</li><li>合理利用构建缓存</li></ul><h2 id="六、升级流程" tabindex="-1">六、升级流程 <a class="header-anchor" href="#六、升级流程" aria-label="Permalink to &quot;六、升级流程&quot;">​</a></h2><ol><li><strong>备份</strong>：数据库、配置文件、上传文件</li><li><strong>拉取新代码</strong>：<code>git pull</code></li><li><strong>重新构建</strong>：<code>docker compose build</code></li><li><strong>执行迁移</strong>：Java 自动；Python 需 <code>alembic upgrade head</code></li><li><strong>重启服务</strong>：<code>docker compose up -d</code></li><li><strong>验证</strong>：访问各端，检查功能正常</li></ol><h2 id="相关链接" tabindex="-1">相关链接 <a class="header-anchor" href="#相关链接" aria-label="Permalink to &quot;相关链接&quot;">​</a></h2><ul><li><a href="/projects/lyedu/quick-start.html">快速开始</a></li><li><a href="/projects/lyedu/configuration.html">配置参考</a></li><li><a href="/projects/lyedu/faq.html">常见问题</a></li><li><a href="https://gitee.com/quxiangshun/ly-edu" target="_blank" rel="noreferrer">项目仓库</a></li></ul>`,49)])])}const u=s(i,[["render",t]]);export{k as __pageData,u as default};
