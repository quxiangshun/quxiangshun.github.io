import{_ as i,o as a,c as e,a2 as n}from"./chunks/framework.C766EroN.js";const k=JSON.parse('{"title":"LyEdu 后端 exe 打包技术分享","description":"","frontmatter":{},"headers":[],"relativePath":"projects/lyedu/py-installer-package.md","filePath":"projects/lyedu/py-installer-package.md"}'),l={name:"projects/lyedu/py-installer-package.md"};function t(h,s,p,d,o,c){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="lyedu-后端-exe-打包技术分享" tabindex="-1">LyEdu 后端 exe 打包技术分享 <a class="header-anchor" href="#lyedu-后端-exe-打包技术分享" aria-label="Permalink to &quot;LyEdu 后端 exe 打包技术分享&quot;">​</a></h1><p>本文档总结 LyEdu Python API（FastAPI）使用 PyInstaller 打包为独立可执行文件的完整过程、遇到的问题及解决方案。</p><hr><h2 id="一、打包步骤" tabindex="-1">一、打包步骤 <a class="header-anchor" href="#一、打包步骤" aria-label="Permalink to &quot;一、打包步骤&quot;">​</a></h2><h3 id="_1-1-环境准备" tabindex="-1">1.1 环境准备 <a class="header-anchor" href="#_1-1-环境准备" aria-label="Permalink to &quot;1.1 环境准备&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装 PyInstaller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">p#</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> windows</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.venv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Scripts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pip.exe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pyinstaller</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Linux</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.venv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pyinstaller</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 确保项目依赖已安装</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lyedu-api-python</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.venv</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Scripts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pip.exe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> requirements.txt</span></span></code></pre></div><h3 id="_1-2-打包命令" tabindex="-1">1.2 打包命令 <a class="header-anchor" href="#_1-2-打包命令" aria-label="Permalink to &quot;1.2 打包命令&quot;">​</a></h3><p><strong>推荐使用 spec 文件</strong>（便于维护 datas、icon 等配置）：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">cd lyedu</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">python</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">python </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m PyInstaller lyedu_backend.spec</span></span></code></pre></div><p>或首次生成 spec 后打包：</p><div class="language-powershell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">python </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">m PyInstaller </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">onefile </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name lyedu_backend main.py</span></span></code></pre></div><h3 id="_1-3-输出产物" tabindex="-1">1.3 输出产物 <a class="header-anchor" href="#_1-3-输出产物" aria-label="Permalink to &quot;1.3 输出产物&quot;">​</a></h3><ul><li><code>dist/lyedu_backend.exe</code>：单文件可执行程序</li><li><code>build/</code>：构建缓存（可删除）</li><li><code>lyedu_backend.spec</code>：打包配置</li></ul><hr><h2 id="二、核心实现要点" tabindex="-1">二、核心实现要点 <a class="header-anchor" href="#二、核心实现要点" aria-label="Permalink to &quot;二、核心实现要点&quot;">​</a></h2><h3 id="_2-1-程序入口" tabindex="-1">2.1 程序入口 <a class="header-anchor" href="#_2-1-程序入口" aria-label="Permalink to &quot;2.1 程序入口&quot;">​</a></h3><p>必须在 <code>main.py</code> 末尾添加 uvicorn 启动逻辑，否则 exe 加载完路由后立即退出（闪退）：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> uvicorn</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    uvicorn.run(app, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">HOST</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="_2-2-配置策略分离" tabindex="-1">2.2 配置策略分离 <a class="header-anchor" href="#_2-2-配置策略分离" aria-label="Permalink to &quot;2.2 配置策略分离&quot;">​</a></h3><table tabindex="0"><thead><tr><th>场景</th><th>配置来源</th><th>说明</th></tr></thead><tbody><tr><td>打包 exe</td><td>仅 <code>~/.lyedu/conf/config.ini</code></td><td>无则生成模板并提示后退出</td></tr><tr><td>开发环境</td><td><code>.env</code> / <code>.env.dev</code></td><td>不使用 config.ini</td></tr></tbody></table><p>打包时通过 <code>sys.frozen</code> 判断，使用 <code>sys.executable</code> 所在目录解析路径（exe 所在目录），而非 <code>__file__</code>（临时解压目录）。</p><h3 id="_2-3-env-环境变量" tabindex="-1">2.3 ENV 环境变量 <a class="header-anchor" href="#_2-3-env-环境变量" aria-label="Permalink to &quot;2.3 ENV 环境变量&quot;">​</a></h3><ul><li>开发默认 <code>ENV=dev</code></li><li>生产命令行启动需显式添加：<code>ENV=prod lyedu_backend.exe</code>（Windows：<code>set ENV=prod &amp;&amp; lyedu_backend.exe</code>）</li></ul><h3 id="_2-4-打包数据文件-datas" tabindex="-1">2.4 打包数据文件（datas） <a class="header-anchor" href="#_2-4-打包数据文件-datas" aria-label="Permalink to &quot;2.4 打包数据文件（datas）&quot;">​</a></h3><p><code>lyedu_backend.spec</code> 中需将 alembic 目录和 alembic.ini 一起打包：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">datas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;alembic.ini&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;alembic&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;alembic&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span></code></pre></div><h3 id="_2-5-alembic-迁移在-exe-中的使用" tabindex="-1">2.5 Alembic 迁移在 exe 中的使用 <a class="header-anchor" href="#_2-5-alembic-迁移在-exe-中的使用" aria-label="Permalink to &quot;2.5 Alembic 迁移在 exe 中的使用&quot;">​</a></h3><ul><li>打包后 alembic 解压在 <code>sys._MEIPASS</code></li><li>每次启动将 alembic 覆盖复制到 <code>~/.lyedu/alembic</code>，便于用户统一管理，且支持 v2、v3 等新迁移随 exe 更新</li><li>运行时通过 <code>Config.set_main_option(&quot;script_location&quot;, str(script_dir))</code> 使用绝对路径，避免 cwd 不同导致找不到目录</li></ul><h3 id="_2-6-exe-图标" tabindex="-1">2.6 exe 图标 <a class="header-anchor" href="#_2-6-exe-图标" aria-label="Permalink to &quot;2.6 exe 图标&quot;">​</a></h3><p>在 spec 的 EXE 中设置：<code>icon=&#39;favicon.ico&#39;</code>，图标文件需与 spec 同目录。</p><hr><h2 id="三、问题与解决方案" tabindex="-1">三、问题与解决方案 <a class="header-anchor" href="#三、问题与解决方案" aria-label="Permalink to &quot;三、问题与解决方案&quot;">​</a></h2><h3 id="_3-1-闪退-双击后窗口一闪而过" tabindex="-1">3.1 闪退（双击后窗口一闪而过） <a class="header-anchor" href="#_3-1-闪退-双击后窗口一闪而过" aria-label="Permalink to &quot;3.1 闪退（双击后窗口一闪而过）&quot;">​</a></h3><p><strong>原因</strong>：无 <code>if __name__ == &quot;__main__&quot;</code> 启动 uvicorn，进程加载完即退出。</p><p><strong>解决</strong>：在 <code>main.py</code> 末尾添加上面的 uvicorn 启动代码。</p><h3 id="_3-2-配置-错误信息一闪而过-用户无法阅读" tabindex="-1">3.2 配置/错误信息一闪而过，用户无法阅读 <a class="header-anchor" href="#_3-2-配置-错误信息一闪而过-用户无法阅读" aria-label="Permalink to &quot;3.2 配置/错误信息一闪而过，用户无法阅读&quot;">​</a></h3><p><strong>原因</strong>：控制台输出后立即退出。</p><p><strong>解决</strong>：</p><ul><li>Windows：使用 <code>ctypes.windll.user32.MessageBoxW</code> 弹出消息框，必须点击确定才关闭</li><li>配置缺失、MySQL/Redis 连接失败、启动失败等场景均弹窗提示</li></ul><h3 id="_3-3-使用错误配置仍能启动" tabindex="-1">3.3 使用错误配置仍能启动 <a class="header-anchor" href="#_3-3-使用错误配置仍能启动" aria-label="Permalink to &quot;3.3 使用错误配置仍能启动&quot;">​</a></h3><p><strong>原因</strong>：未在启动前验证 MySQL/Redis 连接。</p><p><strong>解决</strong>：在 <code>lyedu_config</code> 中增加 <code>test_mysql_connection()</code>、<code>test_redis_connection()</code>，启动前校验，失败则弹窗并退出。</p><h3 id="_3-4-redis-连接失败-connection-refused" tabindex="-1">3.4 Redis 连接失败（connection refused） <a class="header-anchor" href="#_3-4-redis-连接失败-connection-refused" aria-label="Permalink to &quot;3.4 Redis 连接失败（connection refused）&quot;">​</a></h3><p><strong>原因</strong>：</p><ol><li>Docker 中 Redis 默认只监听 <code>127.0.0.1</code>，宿主机通过端口映射连接时被拒绝</li><li><code>localhost</code> 可能解析为 IPv6 <code>::1</code>，而 Redis 仅监听 IPv4</li></ol><p><strong>解决</strong>：</p><ul><li>compose 中增加：<code>command: redis-server --bind 0.0.0.0 ...</code></li><li>代码中将 <code>localhost</code> 替换为 <code>127.0.0.1</code></li></ul><h3 id="_3-5-redis-py-报错-unexpected-keyword-argument-connect-timeout" tabindex="-1">3.5 redis-py 报错：unexpected keyword argument &#39;connect_timeout&#39; <a class="header-anchor" href="#_3-5-redis-py-报错-unexpected-keyword-argument-connect-timeout" aria-label="Permalink to &quot;3.5 redis-py 报错：unexpected keyword argument &#39;connect_timeout&#39;&quot;">​</a></h3><p><strong>原因</strong>：redis-py 使用 <code>socket_connect_timeout</code> 而非 <code>connect_timeout</code>。</p><p><strong>解决</strong>：将所有 Redis 客户端的 <code>connect_timeout</code> 改为 <code>socket_connect_timeout</code>。</p><h3 id="_3-6-redis-7-需要默认用户名" tabindex="-1">3.6 Redis 7 需要默认用户名 <a class="header-anchor" href="#_3-6-redis-7-需要默认用户名" aria-label="Permalink to &quot;3.6 Redis 7 需要默认用户名&quot;">​</a></h3><p><strong>原因</strong>：Redis 6+ ACL 要求显式提供用户名。</p><p><strong>解决</strong>：在配置中增加 <code>REDIS_USERNAME=default</code>，连接时传入 <code>username</code> 参数。</p><h3 id="_3-7-alembic-报错-path-doesn-t-exist-alembic" tabindex="-1">3.7 Alembic 报错：Path doesn&#39;t exist: alembic <a class="header-anchor" href="#_3-7-alembic-报错-path-doesn-t-exist-alembic" aria-label="Permalink to &quot;3.7 Alembic 报错：Path doesn&#39;t exist: alembic&quot;">​</a></h3><p><strong>原因</strong>：<code>alembic.ini</code> 的 <code>script_location = alembic</code> 为相对路径，exe 运行时 cwd 可能是 exe 所在目录或用户目录，导致解析失败。</p><p><strong>解决</strong>：调用 <code>Config.set_main_option(&quot;script_location&quot;, str(script_dir))</code>，传入 alembic 的绝对路径。</p><h3 id="_3-8-数据库迁移版本-v2、v3-如何随-exe-更新" tabindex="-1">3.8 数据库迁移版本（v2、v3）如何随 exe 更新？ <a class="header-anchor" href="#_3-8-数据库迁移版本-v2、v3-如何随-exe-更新" aria-label="Permalink to &quot;3.8 数据库迁移版本（v2、v3）如何随 exe 更新？&quot;">​</a></h3><p><strong>解决</strong>：每次启动时从 <code>_MEIPASS</code> 覆盖复制 alembic 到 <code>~/.lyedu/alembic</code>，保证用户目录与当前 exe 内的迁移脚本一致。</p><hr><h2 id="四、用户目录结构" tabindex="-1">四、用户目录结构 <a class="header-anchor" href="#四、用户目录结构" aria-label="Permalink to &quot;四、用户目录结构&quot;">​</a></h2><p>打包后用户需在 <code>~/.lyedu/</code> 下维护配置与 alembic：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>~/.lyedu/</span></span>
<span class="line"><span>├── conf/</span></span>
<span class="line"><span>│   ├── config.ini          # 实际配置（必须）</span></span>
<span class="line"><span>│   └── config.ini.template # 模板（自动生成）</span></span>
<span class="line"><span>├── alembic/</span></span>
<span class="line"><span>│   ├── env.py</span></span>
<span class="line"><span>│   ├── script.py.mako</span></span>
<span class="line"><span>│   └── versions/</span></span>
<span class="line"><span>│       ├── v1_init_schema.py</span></span>
<span class="line"><span>│       └── ...              # v2、v3 等由 exe 覆盖更新</span></span>
<span class="line"><span>└── alembic.ini</span></span></code></pre></div><h3 id="_4-1-config-ini-示例-与-compose-mysql-redis-yml-一致" tabindex="-1">4.1 config.ini 示例（与 compose-mysql-redis.yml 一致） <a class="header-anchor" href="#_4-1-config-ini-示例-与-compose-mysql-redis-yml-一致" aria-label="Permalink to &quot;4.1 config.ini 示例（与 compose-mysql-redis.yml 一致）&quot;">​</a></h3><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[mysql]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 3306</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = root</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = lyedu123456</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">database</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = lyedu</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">charset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = utf8mb4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[redis]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">host</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 127.0.0.1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = default</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 6379</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">password</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = lyedu123456</span></span></code></pre></div><hr><h2 id="五、redis-docker-相关" tabindex="-1">五、Redis Docker 相关 <a class="header-anchor" href="#五、redis-docker-相关" aria-label="Permalink to &quot;五、Redis Docker 相关&quot;">​</a></h2><ul><li>使用 ACL 时，<code>redis-acl.conf</code> 首行必须是有效的 <code>user</code> 行，不能以注释开头</li><li>推荐 ACL 格式：<code>user default on &gt;lyedu123456 ~* &amp;* +@all</code></li><li>compose 中需加 <code>--bind 0.0.0.0</code> 以便宿主机连接</li></ul><hr><h2 id="六、打包检查清单" tabindex="-1">六、打包检查清单 <a class="header-anchor" href="#六、打包检查清单" aria-label="Permalink to &quot;六、打包检查清单&quot;">​</a></h2><ul><li>[ ] <code>main.py</code> 有 <code>if __name__ == &quot;__main__&quot;</code> 且启动 uvicorn</li><li>[ ] <code>config.py</code> 中打包分支使用 <code>sys.frozen</code>、<code>sys.executable</code></li><li>[ ] <code>lyedu_backend.spec</code> 中 <code>datas</code> 包含 alembic、alembic.ini</li><li>[ ] Redis 使用 <code>socket_connect_timeout</code>、<code>username</code></li><li>[ ] 错误场景有 MessageBox 或 pause，避免闪退</li><li>[ ] 启动前校验 MySQL、Redis 连接</li></ul><hr><h2 id="七、跨平台说明" tabindex="-1">七、跨平台说明 <a class="header-anchor" href="#七、跨平台说明" aria-label="Permalink to &quot;七、跨平台说明&quot;">​</a></h2><ul><li><strong>Windows</strong>：使用 MessageBox 展示错误</li><li><strong>macOS / Linux</strong>：使用 <code>input(&quot;按回车键退出...&quot;)</code> 暂停</li></ul><p><code>sys.frozen</code>、<code>sys._MEIPASS</code> 在 PyInstaller 打包后可用，开发环境不存在这些属性。</p>`,74)])])}const E=i(l,[["render",t]]);export{k as __pageData,E as default};
