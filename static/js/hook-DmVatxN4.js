var t=(r,_,c)=>new Promise((k,$)=>{var L=i=>{try{p(c.next(i))}catch(C){$(C)}},T=i=>{try{p(c.throw(i))}catch(C){$(C)}},p=i=>i.done?k(i.value):Promise.resolve(i.value).then(L,T);p((c=c.apply(r,_)).next())});import{_ as K}from"./labelGroupForm.vue_vue_type_script_setup_true_lang-CvvzdSkg.js";import{_ as Q}from"./subLabelForm.vue_vue_type_script_setup_true_lang-CqgyvE7w.js";import{_ as W}from"./changeSubLabelGroupForm.vue_vue_type_script_setup_true_lang-BJd-Q56x.js";import{n as v,P as X,q as Z,e as h,R as l,h as E,S as O,T as x,U as j,I as w,r as ee,F as ae,aY as ne}from"./index-_ppfBu12.js";import{l as te,d as se,e as le,c as re,a as ce,b as ie,u as oe,f as ue,h as fe,i as de}from"./label-D51pCL6Y.js";import{s as M}from"./index-CIrz3C_X.js";import{t as pe,j as me}from"./category-B2RJSKvQ.js";import"./index-C07DLrIx.js";import"./rule-CeMokVT1.js";import"./hooks-B99vGHGm.js";const be=[{label:"成片",value:0,icon:"noto:crying-face",disabled:!1},{label:"素材",value:1,icon:"noto:face-savoring-food",disabled:!1},{label:"第三方",value:2,icon:"noto:face-with-steam-from-nose",disabled:!1}];function ge(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!ne(r)}function Ge(){const r=v(null),_=X({name:""}),c=v(),k=v([]),$=v([]),L=v([]),T=v(!1),p=v(!0),i=(a,e=!1)=>{if(a==1)return e?"成":"primary";if(a==2)return e?"素":"success";if(a==3)return e?"三":"warning";if(a==4)return e?"图":"danger";if(a==5)return e?"文":"info";if(a==6)return e?"音":"danger";if(a==7)return e?"脚":"info"},C=[{label:"标签名称",prop:"name",align:"left",cellRenderer:({row:a})=>{const e=[],n=a.rootCategoryIds;for(let u=0;u<n.length;u++){let f;const s=n[u];e.push(h(ee("el-tag"),{size:"small",type:i(s),effect:"plain"},ge(f=i(s,!0))?f:{default:()=>[f]}))}return h(ae,null,[h("div",null,[a.name]),e])}},{label:"操作",fixed:"right",width:80,slot:"operation"}];function R(){return t(this,null,function*(){p.value=!0;const{code:a,data:e}=yield te();a==="H200"&&(k.value=e),p.value=!1})}function A(a){if(!a||!a.length)return;const e=[];for(let n=0;n<a.length;n++)a[n].name=a[n].name,A(a[n].children),e.push(a[n]);return e}function N(a="新增",e){return t(this,null,function*(){var m,b,I,d;be.forEach(S=>{S.disabled=(e==null?void 0:e.type)===0&&(e==null?void 0:e.children)&&e.children.length>0&&S.value!==0});const{data:n}=yield pe(-1),u=[],f=[];let s=[];if(e){const{data:S}=yield me(e.id);if(s=S,s)for(let F=0;F<s.length;F++){const G=s[F];u.push(G.id),G.visible===0&&f.push(G.id)}}O({title:`${a}标签组`,props:{formInline:{id:(m=e==null?void 0:e.id)!=null?m:null,higherCategoryOptions:A(w(n)),categoriesByLabelGroup:s,categoryIds:u,visibleCategoryIds:f,parentId:(b=e==null?void 0:e.parentId)!=null?b:0,name:(I=e==null?void 0:e.name)!=null?I:"",visible:(d=e==null?void 0:e.visible)!=null?d:0}},width:"60%",top:"2%",draggable:!0,fullscreen:j(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>x(K,{ref:c}),beforeSure:(G,g)=>t(this,[G,g],function*(S,{options:F}){const D=c.value.getRef(),B=F.props.formInline;function o(){l(`${a}标签：${B.name}成功`,{type:"success"}),S(),R()}D.validate(J=>t(this,null,function*(){if(J)try{if(a==="新增"){const y=yield ue(B);y.code=="H200"?o():l(`${y.message}`,{type:"error"})}else{const y=yield fe(B);y.code=="H200"?o():l(`${y.message}`,{type:"error"})}}catch(y){console.error("Error update menu:",y),l(`${a}标签时出错`,{type:"error"})}}))})})})}function V(a="新增",e){return t(this,null,function*(){var n,u,f,s,m,b;O({title:`${a}标签`,props:{formInline:{id:(n=e==null?void 0:e.id)!=null?n:null,parentId:r.value.id,name:(u=e==null?void 0:e.name)!=null?u:"",effectiveTime:(f=e==null?void 0:e.effectiveTime)!=null?f:[],effectiveTimeStart:(s=e==null?void 0:e.effectiveTimeStart)!=null?s:"",effectiveTimeEnd:(m=e==null?void 0:e.effectiveTimeEnd)!=null?m:"",remark:(b=e==null?void 0:e.remark)!=null?b:""}},width:"60%",top:"2%",draggable:!0,fullscreen:j(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>x(Q,{ref:c}),beforeSure:(S,F)=>t(this,[S,F],function*(I,{options:d}){const G=c.value.getRef(),g=d.props.formInline;function D(){l(`${a}标签：${g.name}成功`,{type:"success"}),I(),H()}G.validate(B=>t(this,null,function*(){if(B){g.effectiveTimeStart=g.effectiveTime[0],g.effectiveTimeEnd=g.effectiveTime[1];try{if(a==="新增"){const o=yield ie(g);o.code=="H200"?D():l(`${o.message}`,{type:"error"})}else{const o=yield oe(g);o.code=="H200"?D():l(`${o.message}`,{type:"error"})}}catch(o){console.error("Error update menu:",o),l(`${a}标签时出错`,{type:"error"})}}}))})})})}function q(){return t(this,null,function*(){const{data:a}=yield le();O({title:"修改选中标签所属标签组",props:{formInline:{labels:a,parentId:r.value.id,subLabelsChecked:L.value}},width:"60%",top:"2%",draggable:!0,fullscreen:j(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>x(W,{ref:c}),beforeSure:(u,f)=>t(this,[u,f],function*(e,{options:n}){const s=c.value.getRef(),m=n.props.formInline;function b(){l("选中标签重新成功分配标签组",{type:"success"}),e(),H(),L.value=[]}s.validate(I=>t(this,null,function*(){if(I)try{const d=yield re(m);d.code=="H200"?b():l(`${d.message}`,{type:"error"})}catch(d){l("选中标签重新分配标签组时出错",{type:"error"})}}))})})})}function z(a){M("警告",{contentRenderer:()=>h("p",{style:"text-align: center;margin-bottom:20px"},[E("确认要删除"),h("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[a.name]),E("吗？此标签的子标签也会被删除")]),beforeSure:e=>t(this,null,function*(){(yield ce(a.id)).code=="H200"&&l(`已删除"${a.name}`,{type:"success"}),e(),R()})})}function P(a){M("警告",{contentRenderer:()=>h("p",{style:"text-align: center;margin-bottom:20px"},[E("确认要删除"),h("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[a.name]),E("吗？")]),beforeSure:e=>t(this,null,function*(){(yield se(a.id)).code=="H200"&&l(`已删除"${a.name}`,{type:"success"}),e(),R()})})}function U(a){r.value=a,H()}function Y(){T.value=!T.value,L.value=[]}function H(){return t(this,null,function*(){if(r.value.id){const{data:a}=yield de(r.value.id);$.value=a}})}return Z(()=>{R()}),{form:_,loading:p,columns:C,dataList:k,onSearch:R,openGroupDialog:N,openSubLabelDialog:V,handleDeleteGroup:z,curLabelCroup:r,clickLabelGroupRow:U,subLabelList:$,changeSubLabelCheckboxDisabled:Y,showSubLabelCheckbox:T,subLabelsChecked:L,openChangeSubLabelGroupDialog:q,handleDeleteSubLabel:P}}export{Ge as useLabel};
