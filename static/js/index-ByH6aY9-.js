var P=(B,_,l)=>new Promise((y,g)=>{var x=u=>{try{f(l.next(u))}catch(C){g(C)}},w=u=>{try{f(l.throw(u))}catch(C){g(C)}},f=u=>u.done?y(u.value):Promise.resolve(u.value).then(x,w);f((l=l.apply(B,_)).next())});import{d as oe,n as m,r as s,i as L,o as i,j as a,ap as Y,e,c as p,F as k,t as V,h as c,y as h,f as F,B as ne,g as ue,R as se,G as O,_ as de}from"./index-vTRDVSJy.js";import{t as re,g as ie,s as M}from"./label-B_Trvi3_.js";import{d as ce}from"./close-line-Dw4sg3MD.js";import{e as ve}from"./mitt-E5P-NQ8u.js";const pe={class:"list-border"},fe=["onClick"],me={class:"list-border"},_e=["onClick"],ge={class:"list-border"},be=oe({__name:"index",props:{formAttrProp:{default:()=>({item:{categories:null,level1CategoryId:null,level2CategoryId:null,taskId:null,labelIds:[],protectionPeriod:"",userIds:[],notice:""},nameLabel:"",depts:[],tasks:[],categoryOptions:[]})},slotAttr:{default:()=>({})}},setup(B){const _=B,l=m(_.formAttrProp.item),y=m(),g=m(_.formAttrProp.categoryOptions),x=m([]),w=m([]),f=m([]),u=m([]),C=n=>{n&&n.validate(t=>P(this,null,function*(){if(t)ve.emit("submitResource",l);else return!1}))},N=n=>{n&&n.resetFields()},U=m([]);function H(){const n=l.value.categories;if(l.value.level1CategoryId!=n[0]&&l.value.level2CategoryId!=n[1]){l.value.level1CategoryId=n[0],l.value.level2CategoryId=n[1];const t=g.value.filter(d=>d.id==l.value.categories[0]);U.value=t&&t[0].children||[],D()}}function T(){const n=l.value.categories;if(l.value.level1CategoryId!=n[0]){l.value.categories[0]=l.value.level1CategoryId;const t=g.value.filter(d=>d.id==l.value.categories[0]);U.value=t&&t[0].children||[]}}function X(){const n=l.value.categories;l.value.level2CategoryId!=n[1]&&(l.value.categories[0]=l.value.level1CategoryId,l.value.categories[1]=l.value.level2CategoryId,u.value=[],l.value.labelIds=[],D())}function j(){if(!(l.value.level1CategoryId&&l.value.level2CategoryId)){se("请先选择一/二级分类",{type:"warning"});return}}function D(){return P(this,null,function*(){const{data:n}=yield re(l.value.level2CategoryId);x.value=n;const{data:t}=yield ie(l.value.level2CategoryId);if(t&&t.length>0){w.value=t;const{data:d}=yield M(t[0].id);f.value=d}})}function q(n){return P(this,null,function*(){const{data:t}=yield M(n);f.value=t})}function z(){O(()=>{const n=f.value.filter(t=>{const d=t.id;return l.value.labelIds.includes(d)});u.value=n})}function J(n){O(()=>{const t=u.value||[];t.findIndex(r=>r.id===n.id)>-1?u.value=t.filter(r=>r.id!==n.id):u.value=[...t,n],l.value.labelIds=u.value.map(r=>r.id)})}function K(n){O(()=>{const t=u.value||[];u.value=t.filter(d=>d.id!==n.id),l.value.labelIds=u.value.map(d=>d.id)})}return(n,t)=>{const d=s("el-cascader"),r=s("el-form-item"),v=s("el-col"),G=s("el-radio"),R=s("el-radio-group"),I=s("el-row"),Q=s("el-option"),W=s("el-select"),b=s("el-text"),$=s("el-card"),Z=s("el-checkbox"),E=s("el-checkbox-group"),ee=s("IconifyIconOffline"),le=s("el-date-picker"),ae=s("el-input"),A=s("el-button"),te=s("el-form");return i(),L(te,{ref_key:"formRef",ref:y,model:l.value,"label-width":"130px"},{default:a(()=>[Y(n.$slots,"top-attr",{},void 0,!0),e(I,null,{default:a(()=>[e(v,null,{default:a(()=>[e(r,{label:`${_.formAttrProp.nameLabel}分类：`},{default:a(()=>[e(d,{modelValue:l.value.categories,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.categories=o),class:"!w-full",placeholder:"请选择脚本分类",options:g.value,props:{value:"id",label:"name",children:"children"},filterable:"",clearable:"",onChange:H},null,8,["modelValue","options"])]),_:1},8,["label"])]),_:1}),e(v,null,{default:a(()=>[e(r,{label:"一级分类"},{default:a(()=>[e(R,{modelValue:l.value.level1CategoryId,"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.level1CategoryId=o),onChange:T},{default:a(()=>[(i(!0),p(k,null,V(g.value,o=>(i(),L(G,{key:o.id,value:o.id},{default:a(()=>[c(h(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(r,{label:"二级分类"},{default:a(()=>[e(R,{modelValue:l.value.level2CategoryId,"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.level2CategoryId=o),onChange:X},{default:a(()=>[(i(!0),p(k,null,V(U.value,o=>(i(),L(G,{key:o.id,value:o.id},{default:a(()=>[c(h(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Y(n.$slots,"middle-attr",{},void 0,!0),e(I,null,{default:a(()=>[e(v,null,{default:a(()=>[e(r,{label:"关联任务："},{default:a(()=>[e(W,{modelValue:l.value.taskId,"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.taskId=o)},{default:a(()=>[(i(!0),p(k,null,V(_.formAttrProp.tasks,o=>(i(),L(Q,{key:o.id,value:o.id,label:o.id},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(v,null,{default:a(()=>[e(r,{label:"公共标签："},{default:a(()=>[e(d,{modelValue:l.value.labelIds,"onUpdate:modelValue":t[4]||(t[4]=o=>l.value.labelIds=o),placeholder:"请选择公共标签",options:x.value,props:{value:"id",label:"name",children:"children",multiple:!0,emitPath:!1},"show-all-levels":!1,"collapse-tags":"",filterable:"",clearable:"",style:{width:"240px"},onFocus:j,onChange:z},null,8,["modelValue","options"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(r,null,{default:a(()=>[e(I,{style:{width:"100%"}},{default:a(()=>[e(v,{span:6},{default:a(()=>[F("div",pe,[e($,{class:"list-container"},{header:a(()=>[e(b,null,{default:a(()=>[c("标签组")]),_:1})]),default:a(()=>[(i(!0),p(k,null,V(w.value,o=>(i(),p("div",{key:o.id,class:"el-list-item",onClick:S=>q(o.id)},[e(b,null,{default:a(()=>[c(h(o.name),1)]),_:2},1024)],8,fe))),128))]),_:1})])]),_:1}),e(v,{span:6},{default:a(()=>[F("div",me,[e($,{class:"list-container"},{header:a(()=>[e(b,null,{default:a(()=>[c("子标签")]),_:1})]),default:a(()=>[e(E,{modelValue:l.value.labelIds,"onUpdate:modelValue":t[5]||(t[5]=o=>l.value.labelIds=o)},{default:a(()=>[(i(!0),p(k,null,V(f.value,o=>(i(),p("div",{key:o.id,class:"el-list-item",onClick:ne(S=>J(o),["prevent"])},[e(Z,{value:o.id},null,8,["value"]),e(b,null,{default:a(()=>[c(h(o.name),1)]),_:2},1024)],8,_e))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1}),e(v,{span:6},{default:a(()=>[F("div",ge,[e($,{class:"list-container"},{header:a(()=>[e(b,null,{default:a(()=>[c("已添加标签")]),_:1})]),default:a(()=>[(i(!0),p(k,null,V(u.value,o=>(i(),p("div",{key:o.id,class:"el-list-item"},[e(b,null,{default:a(()=>[c(h(o.name),1)]),_:2},1024),e(ee,{icon:ue(ce),onClick:S=>K(o)},null,8,["icon","onClick"])]))),128))]),_:1})])]),_:1}),e(v,{span:6})]),_:1})]),_:1})]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(v,null,{default:a(()=>[e(r,{label:"保护期：",prop:"protectionPeriod"},{default:a(()=>[e(le,{modelValue:l.value.protectionPeriod,"onUpdate:modelValue":t[6]||(t[6]=o=>l.value.protectionPeriod=o),type:"datetime",class:"!w-[200px]",placeholder:"请选择保护期","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"]),c(" 到设定日期后，所有人可查看 ")]),_:1})]),_:1})]),_:1}),e(I,null,{default:a(()=>[e(v,null,{default:a(()=>[e(r,{label:"提醒谁看："},{default:a(()=>[e(d,{modelValue:l.value.userIds,"onUpdate:modelValue":t[7]||(t[7]=o=>l.value.userIds=o),placeholder:"请选择人员",options:_.formAttrProp.depts,props:{value:"id",label:"name",children:"children",multiple:!0,emitPath:!1},"show-all-levels":!1,"collapse-tags":"",filterable:"",clearable:"",style:{width:"240px"}},null,8,["modelValue","options"]),e(b,null,{default:a(()=>[c("并发送消息")]),_:1}),e(ae,{modelValue:l.value.notice,"onUpdate:modelValue":t[8]||(t[8]=o=>l.value.notice=o),style:{width:"300px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(r,null,{default:a(()=>[e(A,{type:"primary",text:"",bg:"",onClick:t[9]||(t[9]=o=>C(y.value))},{default:a(()=>[c(" 发布 ")]),_:1}),e(A,{type:"primary",text:"",bg:"",onClick:t[10]||(t[10]=o=>C(y.value))},{default:a(()=>[c(" 发布后，相同配置继续上传 ")]),_:1}),e(A,{text:"",bg:"",onClick:t[11]||(t[11]=o=>N(y.value))},{default:a(()=>[c("重置")]),_:1})]),_:1})]),_:3},8,["model"])}}}),he=de(be,[["__scopeId","data-v-6f1565a6"]]);export{he as X};
