var o=(P,n,c)=>new Promise((B,v)=>{var y=d=>{try{f(c.next(d))}catch(p){v(p)}},F=d=>{try{f(c.throw(d))}catch(p){v(p)}},f=d=>d.done?B(d.value):Promise.resolve(d.value).then(y,F);f((c=c.apply(P,n)).next())});import{P as D,n as l,p as ce,q as de,D as pe,e as r,$ as fe,a2 as me,S as k,T as E,U as z,R as u,bo as ge,bp as he,bq as ve,bj as be,br as ye,F as Re,h as H,r as $,aE as xe,M as Se}from"./index-vTRDVSJy.js";import{_ as Ie}from"./form.vue_vue_type_script_setup_true_lang-Wwf3lLAl.js";import{s as q}from"./index-D8NgSwpL.js";import{z as Ce}from"./index.esm-BK-uHWKN.js";import{u as ke}from"./hooks-BYC6ewR3.js";import{_ as ze}from"./role.vue_vue_type_script_setup_true_lang-BGsepzuR.js";import{g as He,r as Pe,u as A,d as Be,a as Fe,b as Ue,c as De}from"./list-CFwWPV2H.js";import{R as Ee}from"./index-B0LAWXA6.js";import{u as $e}from"./upload-DPcarPpl.js";import{a as Me}from"./rule-Dc12S45i.js";import{b as Le,g as Oe}from"./permission-DFxTWKGm.js";import{l as _e}from"./role-CMJwygUR.js";import"./enums-CaQfD0A1.js";import"./hooks-gvBetFC1.js";import"./index-_Th1-riL.js";function aa(){const{uploadFileByBack:P}=$e(),n=D({total:0,pageSize:10,currentPage:1,background:!0}),c=D({username:"",email:"",status:"",size:n.pageSize,current:n.currentPage}),B=l(),v=l(),y=l([]),F=l(!1),f=l(!0),d=l(!1),p=l({}),{switchStyle:N}=ke(),G=ce(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]),M=l(),m=D({password:""}),X=[{color:"#e74242",text:"非常弱"},{color:"#EFBD47",text:"弱"},{color:"#ffa500",text:"一般"},{color:"#1bbf1b",text:"强"},{color:"#008000",text:"非常强"}],R=l(),L=l(),x=l(),O=l([]),J=[{label:"用户名",prop:"username",width:150,fixed:"left"},{label:"用户昵称",prop:"nickname",width:100,fixed:"left"},{label:"头像",prop:"avatar",width:100,cellRenderer:({row:e})=>r($("el-image"),{lazy:!0,style:"width: 50px; height: 50px;border-radius: 50%",src:e.avatar,"preview-src-list":[e.avatar],"preview-teleported":!0,fit:"cover"},null)},{label:"邮箱",prop:"email",width:170},{label:"手机号",prop:"phone",width:160},{label:"状态",cellRenderer:e=>{var a;return r($("el-switch"),{disabled:xe().isSelf(e.row.id)&&e.row.status===0,size:e.props.size==="small"?"small":"default",loading:(a=p.value[e.index])==null?void 0:a.loading,modelValue:e.row.status,"onUpdate:modelValue":t=>e.row.status=t,"active-value":0,"inactive-value":1,"active-text":"正常","inactive-text":"冻结","inline-prompt":!0,style:N.value,onChange:()=>K(e)},null)},minWidth:80},{label:"性别",prop:"gender",width:80,cellRenderer:({row:e,props:a})=>r($("el-tag"),{size:a.size,type:e.gender===0?"info":e.gender===1?"primary":"danger",effect:"plain"},{default:()=>[e.gender===0?"未知":e.gender===1?"男":"女"]})},{label:"创建时间",prop:"createTime",minWidth:110,width:120,showOverflowTooltip:!0,formatter:({createTime:e})=>fe(e).format("YYYY-MM-DD HH:mm:ss")},{label:"简介",prop:"remark",minWidth:160},{label:"操作",fixed:"right",width:220,slot:"operation"}];function K({row:e,index:a}){q("提示",{contentRenderer:()=>r("p",{style:"text-align: center;margin-bottom:20px"},[H("确认要"),e.status===1?"冻结":"启用",r("strong",{style:"color:var(--el-color-warning);margin:0 5px"},[e.username]),H("吗?")]),beforeSure:t=>o(this,null,function*(){p.value[a]=Object.assign({},p.value[a],{loading:!0});const s=yield De({id:e.id,status:e.status});p.value[a]=Object.assign({},p.value[a],{loading:!1}),s.code=="H200"&&u(`已${e.status===1?"冻结":"启用"}${e.username}`,{type:"success"}),t(),i()}),closeCallBack:({args:t})=>{(t==null?void 0:t.command)!=="sure"&&(e.status===0?e.status=1:e.status=0)}})}function Q(e){q("警告",{contentRenderer:()=>r("p",{style:"text-align: center;margin-bottom:20px"},[H("确认要删除"),r("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.username]),H("吗?")]),beforeSure:a=>o(this,null,function*(){(yield Be([e.id])).code=="H200"&&u(`已删除"${e.userName}`,{type:"success"}),a(),i()})})}function Z(e){n.currentPage=1,n.pageSize=e,i()}function w(e){n.currentPage=e,i()}function ee(e){}function i(){return o(this,null,function*(){f.value=!0,c.current=n.currentPage,c.size=n.pageSize;const{code:e,data:a}=yield He(me(c));e=="H200"&&(y.value=a.records,n.total=a.total,n.pageSize=a.size,n.currentPage=a.current),f.value=!1})}const ae=e=>{e&&(e.resetFields(),i())};function te(e="新增",a){var s,g,b,_,h,S,V,j,T,W;const t=l({});k({title:`${e}用户`,props:{formInline:{id:(s=a==null?void 0:a.id)!=null?s:null,username:(g=a==null?void 0:a.username)!=null?g:"",password:(b=a==null?void 0:a.password)!=null?b:"",nickname:(_=a==null?void 0:a.nickname)!=null?_:"",status:(h=a==null?void 0:a.status)!=null?h:0,gender:(S=a==null?void 0:a.gender)!=null?S:0,email:(V=a==null?void 0:a.email)!=null?V:"",phone:(j=a==null?void 0:a.phone)!=null?j:"",intro:(T=a==null?void 0:a.intro)!=null?T:"",birthday:(W=a==null?void 0:a.birthday)!=null?W:null}},width:"40%",top:"5vh",draggable:!0,fullscreen:z(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>E(Ie,{ref:v}),open:oe=>o(this,[oe],function*({options:I}){if(e!=="新增"){const C=yield Ue(a.id);C.code=="H200"&&(t.value=C.data),I.props.formInline.email=t.value.email,I.props.formInline.phone=t.value.phone}}),beforeSure:(I,{options:oe})=>{const C=v.value.getRef(),U=oe.props.formInline;function Y(){u(`您${e}了用户名为${U.username}的这条数据`,{type:"success"}),I(),i()}C.validate(ie=>o(this,null,function*(){ie&&(e==="新增"?(yield Fe(U)).code=="H200"&&Y():(yield A(U)).code=="H200"&&Y())}))}})}function se(e){k({title:"裁剪、上传头像",width:"40%",closeOnClickModal:!1,fullscreen:z(),contentRenderer:()=>E(Ee,{ref:L,imgSrc:e.avatar,onCropper:a=>{x.value=a}}),beforeSure:a=>{const t=new File([x.value.blob],x.value.info.name,{type:x.value.blob.type});P(t).then(s=>o(this,null,function*(){if(s.code=="H200"){e.avatar=s.data;const g=yield A(e);g.code=="H200"?u("修改成功",{type:"success"}):u(g.message,{type:"error"})}else u(s.message,{type:"error"})})).catch(s=>{u(s.message,{type:"error",duration:3e3})}).finally(()=>{a(),i()})},closeCallBack:()=>L.value.hidePopover()})}function re(e){k({title:`重置 ${e.username} 用户的密码`,width:"30%",draggable:!0,closeOnClickModal:!1,fullscreen:z(),contentRenderer:()=>r(Re,null,[r(he,{ref:M,model:m},{default:()=>[r(ve,{prop:"password",rules:{required:!0,validator:(a,t,s)=>{t===""?s(new Error("请输入密码")):Me.test(t)?s():s(new Error("密码格式必须在6至20个字符之间且不能包含中文"))},trigger:"blur"}},{default:()=>[r(be,{clearable:!0,"show-password":!0,type:"password",modelValue:m.password,"onUpdate:modelValue":a=>m.password=a,placeholder:"请输入新密码"},null)]})]}),r("div",{class:"mt-4 flex mb-4"},[X.map(({color:a,text:t},s)=>r("div",{class:"w-[19vw]",style:{marginLeft:s!==0?"4px":0}},[r(ye,{striped:!0,"striped-flow":!0,duration:R.value===s?6:0,percentage:R.value>=s?100:0,color:a,"stroke-width":10,"show-text":!1},null),r("p",{class:"text-center",style:{color:R.value===s?a:""}},[t])]))])]),closeCallBack:()=>m.password="",beforeSure:a=>{M.value.validate(t=>o(this,null,function*(){t&&(u(`已成功重置 ${e.username} 用户的密码`,{type:"success"}),(yield Pe({id:e.id,password:m.password})).code=="H200"&&(m.password="",a(),i()))}))}})}function le(e){return o(this,null,function*(){var t;const a=l([]);k({title:`分配 ${e.username} 用户的角色`,width:"450px",draggable:!0,fullscreen:z(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>E(ze),open:g=>o(this,[g],function*({options:s}){const b=yield Oe(e.id);b.code=="H200"&&(a.value=b.data),s.props.formInline.roleIds=a.value}),props:{formInline:{username:(t=e==null?void 0:e.username)!=null?t:"",allRoles:O.value,roleIds:a.value}},beforeSure:(b,_)=>o(this,[b,_],function*(s,{options:g}){const h=g.props.formInline;if(h.roleIds.length==0){u("请选择至少一个角色",{type:"error"});return}if(ge(h.roleIds,a.value)){u("所选角色未改变",{type:"error"});return}const{code:S}=yield Le({userId:e.id,roleIds:h.roleIds});S=="H200"&&(u("角色分配成功",{type:"success"}),s(),i())})})})}function ne(){return o(this,null,function*(){const e=yield _e();e.code=="H200"&&(O.value=e.data)})}return de(()=>{i(),ne()}),pe(m,({password:e})=>R.value=Se(e)?-1:Ce(e).score),{form:c,isShow:F,curRow:B,loading:f,columns:J,dataList:y,isLinkage:d,pagination:n,buttonClass:G,onSearch:i,resetForm:ae,openDialog:te,handleDelete:Q,handleSizeChange:Z,handleCurrentChange:w,handleSelectionChange:ee,handleUpload:se,handlePasswordReset:re,handleRole:le}}export{aa as useUserList};
