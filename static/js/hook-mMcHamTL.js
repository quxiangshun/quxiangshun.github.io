var l=(D,b,o)=>new Promise((p,i)=>{var d=u=>{try{f(o.next(u))}catch(c){i(c)}},r=u=>{try{f(o.throw(u))}catch(c){i(c)}},f=u=>u.done?p(u.value):Promise.resolve(u.value).then(d,r);f((o=o.apply(D,b)).next())});import{_ as Z}from"./deptForm.vue_vue_type_script_setup_true_lang-CFzD5b8i.js";import{_ as ee}from"./deptUserForm.vue_vue_type_script_setup_true_lang-BXwQbb0D.js";import{n as s,e as n,G as O,R as v,h as m,S as w,T as L,U as _,F as te,aE as ae,r as le}from"./index-vTRDVSJy.js";import{u as ne}from"./hooks-gvBetFC1.js";import{l as A,a as V,d as se,b as oe,c as ie,e as re,u as M,f as ue}from"./dept-CITvb7DD.js";import{s as E}from"./index-D8NgSwpL.js";import{u as ce}from"./hooks-BYC6ewR3.js";import{e as pe}from"./list-CFwWPV2H.js";import"./index-_Th1-riL.js";import"./rule-B0vC9WgB.js";function Ue(){const D=s(),b=s(),o=s([]),p=s([]),i=s([]),d=s(null),r=s(null),f=s(),u=s(!0),c=s({}),{switchStyle:P}=ce(),j=[{label:"部门名称",prop:"name",align:"left",cellRenderer:({row:e})=>n(te,null,[n("span",{class:"inline-block mr-1"},[L(ne(e.icon),{style:{paddingTop:"1px"}})]),n("span",null,[e.name])])},{label:"状态",cellRenderer:e=>{var t;return n(le("el-switch"),{disabled:ae().isSelf(e.row.id)&&e.row.visible===0,size:e.props.size==="small"?"small":"default",loading:(t=c.value[e.index])==null?void 0:t.loading,modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,"active-value":0,"inactive-value":1,"active-text":"正常","inactive-text":"冻结","inline-prompt":!0,style:P.value,onClick:()=>z(e)},null)},minWidth:60},{label:"操作",fixed:"right",width:80,slot:"operation"}];function z({row:e,index:t}){E("提示",{contentRenderer:()=>n("p",{style:"text-align: center;margin-bottom:20px"},[m("确认要"),e.visible===1?"禁用":"启用",n("strong",{style:"color:var(--el-color-warning);margin:0 5px"},[e.name]),m("吗?")]),beforeSure:a=>l(this,null,function*(){c.value[t]=Object.assign({},c.value[t],{loading:!0});const g=yield M({id:e.id,visible:e.visible});c.value[t]=Object.assign({},c.value[t],{loading:!1}),g.code=="H200"&&v(`已${e.visible===1?"禁用":"启用"}${e.name}`,{type:"success"}),a()}),closeCallBack:({args:a})=>{(a==null?void 0:a.command)!=="sure"&&(e.visible===0?e.visible=1:e.visible=0)}})}const N=[{label:"用户昵称",prop:"nickname",align:"left"},{label:"操作",fixed:"right",width:60,slot:"operation"}];function G(e="新增",t,a=0){var y,R;let g=0,T="";a==1?(g=d.value.id,T=`（父级分组：${d.value.name}）`):a==2&&(g=t.parentId),w({title:`${e}${T}`,props:{formInline:{id:(y=t==null?void 0:t.id)!=null?y:null,parentId:g,name:(R=t==null?void 0:t.name)!=null?R:""}},width:"55%",top:"2%",draggable:!0,fullscreen:_(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>L(Z,{ref:f}),beforeSure:(S,Ee)=>l(this,[S,Ee],function*(h,{options:x}){const X=f.value.getRef(),U=x.props.formInline;function H(){v(`${e}部门：${U.name}成功`,{type:"success"}),h(),e.indexOf("分组")!=-1?k():I()}X.validate(Y=>l(this,null,function*(){if(Y)try{e.indexOf("新增")!=-1?(yield re(U)).code=="H200"&&H():(yield M(U)).code=="H200"&&H()}catch(B){console.error("Error update menu:",B),v(`${e}时出错`,{type:"error"})}}))})})}function W(){return l(this,null,function*(){const{data:e}=yield pe();w({title:"添加关联",props:{formInline:{users:e,deptId:r.value.id}},width:"55%",top:"2%",draggable:!0,fullscreen:_(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>L(ee,{ref:f}),beforeSure:(g,T)=>l(this,[g,T],function*(t,{options:a}){const y=f.value.getRef(),R=a.props.formInline;function h(){v("关联用户成功",{type:"success"}),t(),C()}y.validate(x=>l(this,null,function*(){if(x)try{(yield ie(R)).code=="H200"&&h()}catch(S){console.error("Error update menu:",S),v("关联用户时出错",{type:"error"})}}))})})})}function I(){return l(this,null,function*(){const{data:e}=yield ue();o.value=e.level1Depts,p.value=e.level2Depts,i.value=e.level2DeptUsers})}function k(){return l(this,null,function*(){const{data:e}=yield V(d.value.id);p.value=e.level2Depts,i.value=e.level2DeptUsers})}function C(){return l(this,null,function*(){const{data:e}=yield A(r.value.id);i.value=e.level2DeptUsers})}function q(e,t=""){E("警告",{contentRenderer:()=>n("p",{style:"text-align: center;margin-bottom:20px"},[m("确认要删除"),n("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.name]),m("吗？此部门的子部门也会被删除")]),beforeSure:a=>l(this,null,function*(){(yield oe(e.id)).code=="H200"&&v(`已删除"${e.name}`,{type:"success"}),a(),t.indexOf("二级")?k():I()})})}function J(e){E("警告",{contentRenderer:()=>n("p",{style:"text-align: center;margin-bottom:20px"},[m("确认要删除"),n("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[r.value.name]),m("和"),n("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.name]),m("吗？")]),beforeSure:t=>l(this,null,function*(){(yield se(r.value.id,e.id)).code=="H200"&&v(`已删除"${e.name}的关联数据`,{type:"success"}),t(),C()})})}function K(e){O(()=>l(this,null,function*(){d.value=e;const{data:t}=yield V(e.id);p.value=t.level2Depts,i.value=t.level2DeptUsers,$()}))}function Q(e){O(()=>l(this,null,function*(){r.value=e;const{data:t}=yield A(e.id);i.value=t.level2DeptUsers,F()}))}function F(){const{setCurrentRow:e}=D.value.getTableRef();o.value&&(d.value=o.value[0],e(d.value))}function $(){const{setCurrentRow:e}=b.value.getTableRef();p.value&&(r.value=p.value[0],e(r.value))}return setTimeout(()=>{F(),$()},500),{singleLevel1DeptTableRef:D,singleLevel2DeptTableRef:b,deptColumns:j,userColumns:N,openDeptDialog:G,openDeptUserDialog:W,handleDeleteDept:q,handleDeleteDeptUser:J,level1DeptList:o,level2DeptList:p,level2DeptUserList:i,clickLevel1Row:K,clickLevel2Row:Q,loading:u}}export{Ue as useTabPane};
