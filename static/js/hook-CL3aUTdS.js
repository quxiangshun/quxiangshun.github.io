var u=(a,o,i)=>new Promise((h,f)=>{var v=l=>{try{g(i.next(l))}catch(c){f(c)}},m=l=>{try{g(i.throw(l))}catch(c){f(c)}},g=l=>l.done?h(l.value):Promise.resolve(l.value).then(v,m);g((i=i.apply(a,o)).next())});import{P as I,n as r,p as j,q,e as d,$ as C,a2 as U,R as N,h as Y,S as w,T as E,U as G,r as x}from"./index-vTRDVSJy.js";import{_ as J}from"./form.vue_vue_type_script_setup_true_lang-CgOKwXe8.js";import{s as K}from"./index-D8NgSwpL.js";import{a as Q,d as W,b as X,u as Z,c as ee,o as te}from"./index-DCcLeLk5.js";import{l as ae}from"./role-CMJwygUR.js";import"./upload-DPcarPpl.js";import"./hooks-gvBetFC1.js";function ue(){const a=I({total:0,pageSize:10,currentPage:1,background:!0}),o=I({title:"",type:"",status:"",size:a.pageSize,current:a.currentPage}),i=r(),h=r(),f=r([]),v=r(!1),m=r(!0),g=r(!1),l=j(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]),c=r([]),k=[{label:"标题",prop:"title",width:150,fixed:"left",showOverflowTooltip:!0,cellRenderer:({row:e,props:t})=>d(x("el-Text"),{type:"primary",size:t.size,style:"cursor: pointer",onClick:()=>{te(e,{})}},{default:()=>[e.title]})},{label:"类型",prop:"type",width:100,fixed:"left",cellRenderer:({row:e,props:t})=>d(x("el-tag"),{size:t.size,type:e.type===1?"primary":"danger",effect:"plain"},{default:()=>[e.type==1?"通知":"公告"]})},{label:"内容",prop:"content",width:170,showOverflowTooltip:!0},{label:"状态",prop:"status",width:80,cellRenderer:({row:e,props:t})=>d(x("el-tag"),{size:t.size,type:e.status===0?"success":"danger",effect:"plain"},{default:()=>[e.status==0?"正常":"关闭"]})},{label:"通知角色",prop:"roleNameArr",width:160,showOverflowTooltip:!0},{label:"创建人",prop:"creator",width:100},{label:"创建时间",prop:"createTime",showOverflowTooltip:!0,formatter:({createTime:e})=>C(e).format("YYYY-MM-DD HH:mm:ss")},{label:"修改时间",prop:"updateTime",showOverflowTooltip:!0,cellRenderer:({row:e})=>d("span",null,[e.updateTime?C(e.updateTime).format("YYYY-MM-DD HH:mm:ss"):""])},{label:"修改人",prop:"modifier",width:100},{label:"操作",fixed:"right",width:160,slot:"operation"}];function P(e){K("警告",{contentRenderer:()=>d("p",{style:"text-align: center;margin-bottom:20px"},[Y("确认要删除"),d("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.title]),Y("吗?")]),beforeSure:t=>u(this,null,function*(){(yield W([e.id])).code=="H200"&&N(`已删除"${e.title}`,{type:"success"}),t(),n()})})}function M(e){a.currentPage=1,a.pageSize=e,n()}function O(e){a.currentPage=e,n()}function $(e){}function n(){return u(this,null,function*(){m.value=!0,o.current=a.currentPage,o.size=a.pageSize;const{code:e,data:t}=yield Q(U(o));e=="H200"&&(f.value=t.records,a.total=t.total,a.pageSize=t.size,a.currentPage=t.current),m.value=!1})}const L=e=>{e&&(e.resetFields(),n())};function A(e="新增",t){var R,z,S,H,D;const p=r({});w({title:`${e}通知公告`,props:{formInline:{id:(R=t==null?void 0:t.id)!=null?R:null,title:(z=t==null?void 0:t.title)!=null?z:"",content:(S=t==null?void 0:t.content)!=null?S:"",status:(H=t==null?void 0:t.status)!=null?H:0,type:(D=t==null?void 0:t.type)!=null?D:1,allRoles:c.value,editorHeight:"300px"}},width:"65%",top:"3vh",draggable:!0,fullscreen:G(),fullscreenIcon:!0,closeOnClickModal:!1,fullscreenCallBack:({options:s})=>s.fullscreen?s.props.formInline.editorHeight="400px":s.props.formInline.editorHeight="300px",contentRenderer:()=>E(J,{ref:h}),open:_=>u(this,[_],function*({options:s}){if(e!=="新增"){const y=yield ee(t.id);y.code=="H200"&&(p.value=y.data),s.props.formInline.content=p.value.content,s.props.formInline.status=p.value.status,s.props.formInline.type=p.value.type,s.props.formInline.roleIds=p.value.roleIds}}),beforeSure:(s,{options:_})=>{const y=h.value.getRef(),b=_.props.formInline;function T(){N(`您${e}了通知公告为${b.title}的这条数据`,{type:"success"}),s(),n()}y.validate(B=>u(this,null,function*(){B&&(e==="新增"?(yield X(b)).code=="H200"&&T():(yield Z(b)).code=="H200"&&T())}))}})}function F(){return u(this,null,function*(){const e=yield ae();e.code=="H200"&&(c.value=e.data)})}return q(()=>{n(),F()}),{form:o,isShow:v,curRow:i,loading:m,columns:k,dataList:f,isLinkage:g,pagination:a,buttonClass:l,onSearch:n,resetForm:L,openDialog:A,handleDelete:P,handleSizeChange:M,handleCurrentChange:O,handleSelectionChange:$}}export{ue as useSystemNotice};
