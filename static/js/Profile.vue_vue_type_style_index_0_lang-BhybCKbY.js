var V=(U,k,d)=>new Promise((w,g)=>{var f=o=>{try{v(d.next(o))}catch(c){g(c)}},x=o=>{try{v(d.throw(o))}catch(c){g(c)}},v=o=>o.done?w(o.value):Promise.resolve(o.value).then(f,x);v((d=d.apply(U,k)).next())});import{d as W,n as m,P as X,aE as i,r as n,c as A,f as p,e,j as a,g as _,h as y,y as I,F,t as N,U as O,a3 as Z,R as T,o as h,i as D,T as ee}from"./index-z501862F.js";import{R as oe}from"./index-BlPsTnz3.js";import{d as ae}from"./upload-line-ClmDKJCy.js";import{g as le,u as te}from"./account-CKInIwTH.js";import{u as ne}from"./upload-Bdkl1Dtb.js";import{g as re}from"./enums-CaQfD0A1.js";import{f as se}from"./rule-ClTArEC9.js";import{s as ie}from"./index-C27yIgHt.js";const de=p("h3",{class:"my-8"},"个人信息",-1),ce=p("span",{class:"ml-2"},"更新头像",-1),ue={style:{height:"80px",display:"flex","align-items":"center"}},me={style:{height:"80px",width:"100%"},class:"item-center"},pe={style:{display:"flex",width:"100%"}},fe={class:"flex justify-center items-center"},_e={class:"dialog-footer"},Ve=W({name:"Profile",__name:"Profile",setup(U){const k=m(""),d=m(),w=m(),g=m(),f=m(!1),x=m(),{uploadFileByBack:v}=ne(),o=X({avatar:i().avatar,nickname:i().nickname,intro:i().intro,birthday:i().birthday,gender:i().gender}),c=m({username:i().username,roleArr:[]}),H=s=>{const l=new FileReader;l.onload=b=>{k.value=b.target.result,f.value=!0},l.readAsDataURL(s.raw)},C=()=>{w.value.hidePopover(),g.value.clearFiles(),f.value=!1},P=s=>{d.value=s},z=()=>{const s=new File([d.value.blob],d.value.info.name,{type:d.value.blob.type});v(s).then(l=>{l.code=="H200"?(o.avatar=l.data,T("上传成功",{type:"success"})):T(l.message,{type:"error"}),C()})},j=s=>V(this,null,function*(){s&&(yield s.validate((l,b)=>{if(l)ie("提示",{contentRenderer:()=>ee("div",{class:"text-[16px] mb-4 text-center"},"确定要更新吗？"),beforeSure:R=>V(this,null,function*(){const r={avatar:o.avatar,nickname:o.nickname,intro:o.intro,birthday:o.birthday,gender:o.gender};(yield te(r)).code=="H200"&&(T("更新成功",{type:"success"}),i().SET_AVATAR(r.avatar),i().SET_NICKNAME(r.nickname),i().SET_INTRO(r.intro),i().SET_BIRTHDAY(r.birthday),i().SET_GENDER(r.gender),R())}),closeCallBack:({args:R})=>{}});else return b}))});function L(){return V(this,null,function*(){const s=yield le();s.code=="H200"&&(c.value.roleArr=s.data)})}return L(),(s,l)=>{const b=n("el-avatar"),R=n("IconifyIconOffline"),r=n("el-button"),E=n("el-upload"),u=n("el-form-item"),S=n("el-col"),M=n("el-scrollbar"),G=n("el-row"),B=n("el-input"),K=n("el-date-picker"),Y=n("IconifyIconOnline"),$=n("el-radio"),q=n("el-radio-group"),J=n("el-form"),Q=n("el-dialog");return h(),A("div",{class:Z([["min-w-[180px]",_(O)()?"max-w-[100%]":"max-w-[70%]"],"user-account-profile"])},[de,e(J,{ref_key:"userInfoFormRef",ref:x,rules:_(se),"label-position":"top",model:o},{default:a(()=>[e(G,{gutter:20},{default:a(()=>[e(S,{span:8},{default:a(()=>[e(u,{label:"头像"},{default:a(()=>[e(b,{size:80,src:o.avatar},null,8,["src"]),e(E,{ref_key:"uploadRef",ref:g,accept:"image/*",action:"#",limit:1,"auto-upload":!1,"show-file-list":!1,"on-change":H},{default:a(()=>[e(r,{text:"",bg:"",type:"primary",class:"ml-4"},{default:a(()=>[e(R,{icon:_(ae)},null,8,["icon"]),ce]),_:1})]),_:1},512)]),_:1})]),_:1}),e(S,{span:8},{default:a(()=>[e(u,{label:"用户名",prop:"username"},{default:a(()=>[p("div",ue,[e(r,{text:"",bg:""},{default:a(()=>[y(I(c.value.username),1)]),_:1})])]),_:1})]),_:1}),e(S,{span:8},{default:a(()=>[e(u,{label:"角色",prop:"username"},{default:a(()=>[p("div",me,[e(M,null,{default:a(()=>[p("div",pe,[(h(!0),A(F,null,N(c.value.roleArr,t=>(h(),D(r,{key:t.roleCode,text:"",bg:""},{default:a(()=>[y(I(t.roleName)+"（"+I(t.roleCode)+"） ",1)]),_:2},1024))),128))])]),_:1})])]),_:1})]),_:1})]),_:1}),e(u,{label:"昵称",prop:"nickname"},{default:a(()=>[e(B,{modelValue:o.nickname,"onUpdate:modelValue":l[0]||(l[0]=t=>o.nickname=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),e(u,{label:"生日",prop:"birthday"},{default:a(()=>[e(K,{modelValue:o.birthday,"onUpdate:modelValue":l[1]||(l[1]=t=>o.birthday=t),type:"date",placeholder:"请选择生日"},null,8,["modelValue"])]),_:1}),e(u,{label:"性别",prop:"gender"},{default:a(()=>[e(q,{modelValue:o.gender,"onUpdate:modelValue":l[2]||(l[2]=t=>o.gender=t)},{default:a(()=>[(h(!0),A(F,null,N(_(re),t=>(h(),D($,{key:t.value,value:t.value,border:""},{default:a(()=>[p("span",fe,[e(Y,{icon:t.icon,class:"mr-1"},null,8,["icon"]),y(" "+I(t.label),1)])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"简介"},{default:a(()=>[e(B,{modelValue:o.intro,"onUpdate:modelValue":l[3]||(l[3]=t=>o.intro=t),placeholder:"请输入简介",type:"textarea",autosize:{minRows:6,maxRows:8},maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(r,{type:"primary",onClick:l[4]||(l[4]=t=>j(x.value))},{default:a(()=>[y(" 更新信息 ")]),_:1})]),_:1},8,["rules","model"]),e(Q,{modelValue:f.value,"onUpdate:modelValue":l[5]||(l[5]=t=>f.value=t),width:"40%",title:"编辑头像","destroy-on-close":"",closeOnClickModal:!1,"before-close":C,fullscreen:_(O)()},{footer:a(()=>[p("div",_e,[e(r,{bg:"",text:"",onClick:C},{default:a(()=>[y("取消")]),_:1}),e(r,{bg:"",text:"",type:"primary",onClick:z},{default:a(()=>[y(" 确定 ")]),_:1})])]),default:a(()=>[e(_(oe),{ref_key:"cropRef",ref:w,imgSrc:k.value,onCropper:P},null,8,["imgSrc"])]),_:1},8,["modelValue","fullscreen"])],2)}}});export{Ve as _};
