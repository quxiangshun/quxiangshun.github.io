var n=(l,y,u)=>new Promise((p,i)=>{var T=s=>{try{d(u.next(s))}catch(m){i(m)}},C=s=>{try{d(u.throw(s))}catch(m){i(m)}},d=s=>s.done?p(s.value):Promise.resolve(s.value).then(T,C);d((u=u.apply(l,y)).next())});import{_ as X}from"./form.vue_vue_type_script_setup_true_lang-BpQwJPge.js";import{aP as g,aX as b,P as G,n as r,q as K,e as v,M as Q,bh as Y,bi as A,R as c,h as $,S as Z,T as L,U as w,I as ee,aE as te,r as ae}from"./index-B7W7rs76.js";import{s as M}from"./index-B9geSWXR.js";import{t as le,c as se}from"./category-DZVAWecF.js";import{u as ie}from"./hooks-lRjJeveP.js";import"./index-By3I6NGF.js";import"./index-HNrZqkcq.js";import"./hooks-D07EST8v.js";const h="/sdScriptTemplate",ne=l=>g.request("post",b(`${h}/create`),{data:l}),ue=l=>g.request("get",b(`${h}/list`),{data:l}),U=l=>g.request("put",b(`${h}/update`),{data:l}),oe=l=>g.request("put",b(`${h}/updateStatus`),{data:l}),re=l=>g.request("delete",b(`${h}/delete/${l}`));function ye(){const l=G({title:""}),y=r(),u=r([]),p=r(!0),i=r({}),{switchStyle:T}=ie(),C=[{label:"名称",prop:"name"},{label:"状态",cellRenderer:e=>{var t;return v(ae("el-switch"),{disabled:te().isSelf(e.row.id)&&e.row.visible===0,size:e.props.size==="small"?"small":"default",loading:(t=i.value[e.index])==null?void 0:t.loading,modelValue:e.row.visible,"onUpdate:modelValue":a=>e.row.visible=a,"active-value":0,"inactive-value":1,"active-text":"正常","inactive-text":"冻结","inline-prompt":!0,style:T.value,onClick:()=>m(e)},null)},minWidth:60},{label:"操作",fixed:"right",width:80,slot:"operation"}];function d(e){}function s(){return n(this,null,function*(){p.value=!0;const{code:e,data:t}=yield ue();let a=t;e!="H200"||(Q(l.title)||(a=a.filter(f=>f.title.includes(l.title))),u.value=Y(a)),p.value=!1})}function m({row:e,index:t}){M("提示",{contentRenderer:()=>v("p",{style:"text-align: center;margin-bottom:20px"},[$("确认要"),e.visible===1?"禁用":"启用",v("strong",{style:"color:var(--el-color-warning);margin:0 5px"},[e.name]),$("吗?")]),beforeSure:a=>n(this,null,function*(){i.value[t]=Object.assign({},i.value[t],{loading:!0});const f=yield oe({id:e.id,visible:e.visible});i.value[t]=Object.assign({},i.value[t],{loading:!1}),f.code=="H200"&&c(`已${e.visible===1?"冻结":"启用"}${e.username}`,{type:"success"}),a(),s()}),closeCallBack:({args:a})=>{(a==null?void 0:a.command)!=="sure"&&(e.visible===0?e.visible=1:e.visible=0)}})}function R(e){if(!e||!e.length)return;const t=[];for(let a=0;a<e.length;a++)e[a].title=e[a].title,R(e[a].children),t.push(e[a]);return t}function V(e="新增",t){return n(this,null,function*(){var H,O,k,D,E,q;const{data:a}=yield le(0),{data:f}=yield se();Z({title:`${e}视频合集`,props:{formInline:{id:(H=t==null?void 0:t.id)!=null?H:null,types:f,type:(O=t==null?void 0:t.type)!=null?O:0,higherScriptTemplateOptions:R(ee(a)),categoryId:(k=t==null?void 0:t.categoryId)!=null?k:0,title:(D=t==null?void 0:t.title)!=null?D:"",sortOrder:(E=t==null?void 0:t.sortOrder)!=null?E:1,visible:(q=t==null?void 0:t.visible)!=null?q:0}},width:"55%",top:"2%",draggable:!0,fullscreen:w(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>L(X,{ref:y}),beforeSure:(Te,Ce)=>n(this,[Te,Ce],function*(z,{options:J}){const N=y.value.getRef(),B=J.props.formInline;function I(){c(`${e}视频合集：${B.title}成功`,{type:"success"}),z(),s()}N.validate(W=>n(this,null,function*(){if(W)try{if(e==="新增"){const o=yield ne(B);o.code=="H200"?I():c(`${o.message}`,{type:"error"})}else{const o=yield U(B);o.code=="H200"?I():c(`${o.message}`,{type:"error"})}}catch(o){console.error("Error update menu:",o),c(`${e}视频合集时出错`,{type:"error"})}}))})})})}function j(e){M("警告",{contentRenderer:()=>v("p",{style:"text-align: center;margin-bottom:20px"},[$("确认要删除"),v("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.title]),$("吗？此视频合集的子视频合集也会被删除")]),beforeSure:t=>n(this,null,function*(){(yield re(e.id)).code=="H200"&&c(`已删除"${e.title}`,{type:"success"}),t(),s()})})}const x=r(""),F=r(""),S=r({id:null,options:"",rule:""});function P(e,t){x.value=A.formCreate.parseJson(e.rule),F.value=A.formCreate.parseJson(e.options),S.value=e,t.setRule(x.value),t.setOptions(F.value)}function _(e){return n(this,null,function*(){S.value.options=e.options,S.value.rule=e.rule,yield U(S.value)})}return K(()=>{s()}),{form:l,loading:p,columns:C,dataList:u,onSearch:s,openDialog:V,handleDelete:j,handleSelectionChange:d,clickRowLoadForm:P,handleSave:_}}export{ye as useScriptTemplate};
