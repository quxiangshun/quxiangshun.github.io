var f=(l,r,s)=>new Promise((u,p)=>{var g=a=>{try{d(s.next(a))}catch(c){p(c)}},o=a=>{try{d(s.throw(a))}catch(c){p(c)}},d=a=>a.done?u(a.value):Promise.resolve(a.value).then(g,o);d((s=s.apply(l,r)).next())});import{m as K,_ as Q}from"./form.vue_vue_type_script_setup_true_lang-BrofV_QU.js";import{P as W,n as v,q as X,e as i,w as Z,M as L,bh as w,R as F,h as A,S as ee,T as E,U as te,I as ne,F as ae,r as M,b as le,aY as se}from"./index-vTRDVSJy.js";import{u as ie}from"./hooks-gvBetFC1.js";import{l as ce,d as ue,a as pe,u as de,g as N}from"./types-BVQ0IP4t.js";import{s as fe}from"./index-D8NgSwpL.js";import"./index-_Th1-riL.js";import"./index-CeG7CI6B.js";function P(l){return typeof l=="function"||Object.prototype.toString.call(l)==="[object Object]"&&!se(l)}function Fe(){const l=W({title:""}),r=v(),s=v([]),u=v(!0),p=(t,e=!1)=>t==0?e?"显示":"success":e?"隐藏":"danger",g=[{label:"菜单名称",prop:"title",align:"left",cellRenderer:({row:t})=>i(ae,null,[i("span",{class:"inline-block mr-1"},[E(ie(t.icon),{style:{paddingTop:"1px"}})]),i("span",null,[t.title])])},{label:"菜单类型",prop:"type",width:100,cellRenderer:({row:t,props:e})=>{let n;return i(M("el-tag"),{size:e.size,type:N(t.type),effect:"plain"},P(n=N(t.type,!0))?n:{default:()=>[n]})}},{label:"路由名称",prop:"name"},{label:"路由路径",prop:"path"},{label:"组件路径",prop:"component"},{label:"权限标识",prop:"perms",cellRenderer:({row:t})=>t.perms?Z(i(M("el-text"),{type:"success"},{default:()=>[t.perms]}),[[le("copy"),t.perms,"click"]]):null},{label:"排序",prop:"sortOrder",width:100},{label:"显示状态",prop:"visible",cellRenderer:({row:t,props:e})=>{let n;return i(M("el-tag"),{size:e.size,type:p(t.visible),effect:"plain"},P(n=p(t.visible,!0))?n:{default:()=>[n]})},width:100},{label:"操作",fixed:"right",width:210,slot:"operation"}];function o(t){}function d(t){t&&(t.resetFields(),a())}function a(){return f(this,null,function*(){u.value=!0;const{code:t,data:e}=yield ce();let n=e;t!="H200"||(L(l.title)||(n=n.filter(m=>m.title.includes(l.title))),s.value=w(n)),u.value=!1})}function c(t){if(!t||!t.length)return;const e=[];for(let n=0;n<t.length;n++)t[n].title=t[n].title,c(t[n].children),e.push(t[n]);return e}function q(t="新增",e){var n,m,R,D,x,I,O,S,T,_,C,H,$,j,k,z,B;K.forEach(h=>{h.disabled=(e==null?void 0:e.type)===0&&(e==null?void 0:e.children)&&e.children.length>0&&h.value!==0}),ee({title:`${t}菜单`,props:{formInline:{id:(n=e==null?void 0:e.id)!=null?n:null,type:(m=e==null?void 0:e.type)!=null?m:0,higherMenuOptions:c(ne(s.value)),parentId:(R=e==null?void 0:e.parentId)!=null?R:0,title:(D=e==null?void 0:e.title)!=null?D:"",name:(x=e==null?void 0:e.name)!=null?x:"",path:(I=e==null?void 0:e.path)!=null?I:"",component:(O=e==null?void 0:e.component)!=null?O:"",sortOrder:(S=e==null?void 0:e.sortOrder)!=null?S:1,redirect:(T=e==null?void 0:e.redirect)!=null?T:"",icon:(_=e==null?void 0:e.icon)!=null?_:"",extraIcon:(C=e==null?void 0:e.extraIcon)!=null?C:"",activePath:(H=e==null?void 0:e.activePath)!=null?H:"",perms:($=e==null?void 0:e.perms)!=null?$:"",frameSrc:(j=e==null?void 0:e.frameSrc)!=null?j:"",frameLoading:(k=e==null?void 0:e.frameLoading)!=null?k:0,cacheFlag:(z=e==null?void 0:e.cacheFlag)!=null?z:0,visible:(B=e==null?void 0:e.visible)!=null?B:0}},width:"55%",top:"2%",draggable:!0,fullscreen:te(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>E(Q,{ref:r}),beforeSure:(De,xe)=>f(this,[De,xe],function*(h,{options:Y}){const G=r.value.getRef(),b=Y.props.formInline;function V(){F(`${t}菜单：${b.title}成功`,{type:"success"}),h(),a()}G.validate(J=>f(this,null,function*(){if(J)try{t==="新增"?(yield pe(b)).code=="H200"&&V():(yield de(b)).code=="H200"&&V()}catch(y){console.error("Error update menu:",y),F(`${t}菜单时出错`,{type:"error"})}}))})})}function U(t){fe("警告",{contentRenderer:()=>i("p",{style:"text-align: center;margin-bottom:20px"},[A("确认要删除"),i("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[t.title]),A("吗？此菜单的子菜单也会被删除")]),beforeSure:e=>f(this,null,function*(){(yield ue(t.id)).code=="H200"&&F(`已删除"${t.title}`,{type:"success"}),e(),a()})})}return X(()=>{a()}),{form:l,loading:u,columns:g,dataList:s,onSearch:a,resetForm:d,openDialog:q,handleDelete:U,handleSelectionChange:o}}export{Fe as useMenu};
