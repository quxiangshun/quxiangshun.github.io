var b=(t,l,n)=>new Promise((y,s)=>{var m=o=>{try{c(n.next(o))}catch(p){s(p)}},u=o=>{try{c(n.throw(o))}catch(p){s(p)}},c=o=>o.done?y(o.value):Promise.resolve(o.value).then(m,u);c((n=n.apply(t,l)).next())});import{P as T,n as d,q as F,e as a,w as k,$ as v,a2 as C,S as O,T as A,U as H,bl as D,R as x,h,r as f,F as M,b as P,be as _,aY as L}from"./index-B7W7rs76.js";import{_ as j}from"./form.vue_vue_type_script_setup_true_lang-DG36ZDVk.js";import{s as B}from"./index-B9geSWXR.js";import{l as U,d as I}from"./upload-BNUeVoOG.js";import"./upload-2-line-CWGyx_9V.js";import"./hooks-D07EST8v.js";function N(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!L(t)}function K(){const t=T({total:0,pageSize:10,currentPage:1,background:!0}),l=T({type:"",uploadTimeArr:null,size:t.pageSize,current:t.currentPage}),n=d(!1),y=d(),s=d(),m=d([]),u=d(!0),c=[{label:"文件名",prop:"name",width:200,fixed:"left",showOverflowTooltip:!0},{label:"文件内容",prop:"url",cellRenderer:({row:e})=>a(M,null,[e.type.includes("image")&&a(f("el-image"),{lazy:!0,src:e.url,style:"width: 100px; height: 100px","preview-src-list":[e.url],"preview-teleported":!0,fit:"cover"},null),e.type.includes("video")&&a("video",{width:"100",height:"100",controls:!0},[a("source",{src:e.url,type:"video/mp4"},null)]),e.type.includes("pdf")&&a(f("el-link"),{type:"primary",href:e.url,underline:!1,target:"_blank"},{default:()=>[h("预览")]}),!e.type.includes("image")&&!e.type.includes("pdf")&&!e.type.includes("video")&&a(f("el-link"),{type:"primary",download:!0,href:e.url,underline:!1,target:"_blank"},{default:()=>[h("下载")]})])},{label:"文件URL",prop:"url",minWidth:300,showOverflowTooltip:!0,cellRenderer:({row:e})=>k(a(f("el-text"),{type:"success"},{default:()=>[e.url]}),[[P("copy"),e.url,"click"]])},{label:"文件路径",prop:"path",width:160,showOverflowTooltip:!0},{label:"文件类型",prop:"type",width:150,showOverflowTooltip:!0},{label:"文件大小",prop:"size",width:100,showOverflowTooltip:!0,cellRenderer:({row:e})=>{let r;return a(f("el-text"),{type:"success"},N(r=_(e.size))?r:{default:()=>[r]})}},{label:"创建时间",prop:"createTime",width:160,showOverflowTooltip:!0,formatter:({createTime:e})=>v(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:100,slot:"operation"}];function o(e){B("警告",{contentRenderer:()=>a("p",{style:"text-align: center;margin-bottom:20px"},[h("确认要删除"),a("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.name]),h("吗?")]),beforeSure:r=>b(this,null,function*(){(yield I(e.id)).code=="H200"&&x(`已删除"${e.name}`,{type:"success"}),r(),i()})})}function p(e){t.currentPage=1,t.pageSize=e,i()}function R(e){t.currentPage=e,i()}function S(e){}function i(){return b(this,null,function*(){u.value=!0,l.current=t.currentPage,l.size=t.pageSize,l.uploadTimeArr!==null&&l.uploadTimeArr.length==2&&(l.uploadTimeArr[0]=v(l.uploadTimeArr[0]).format("YYYY-MM-DD HH:mm:ss"),l.uploadTimeArr[1]=v(l.uploadTimeArr[1]).format("YYYY-MM-DD HH:mm:ss"));const{code:e,data:r}=yield U(C(l));e=="H200"&&(m.value=r.records,t.total=r.total,t.pageSize=r.size,t.currentPage=r.current),u.value=!1})}const Y=e=>{e&&(e.resetFields(),i())};function z(){O({title:"上传文件",props:{formInline:{fileList:[]}},width:"40%",top:"5vh",draggable:!0,fullscreen:H(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:({options:e,index:r})=>A(j,{ref:s,onUploadResult:g=>{g?(D(e,r),i()):e.footerButtons.forEach(w=>{w.loading=!1})}}),footerButtons:[{label:"取消",text:!0,bg:!0,btnClick:({dialog:{options:e,index:r}})=>{D(e,r)}},{label:"确定",text:!0,bg:!0,type:"primary",btnClick:({dialog:{options:e},button:r})=>{const g=s.value.getRef();if(e.props.formInline.fileList.length==0){x("请选择文件",{type:"error"});return}r.btn.loading=!0,g.submit()}}]})}return F(()=>{i()}),{isShow:n,queryForm:l,curRow:y,loading:u,columns:c,dataList:m,pagination:t,onSearch:i,resetForm:Y,handleDelete:o,handleSizeChange:p,handleCurrentChange:R,handleSelectionChange:S,handleUpload:z}}export{K as useFileList};
