var h=(c,r,e)=>new Promise((_,b)=>{var m=d=>{try{v(e.next(d))}catch(n){b(n)}},D=d=>{try{v(e.throw(d))}catch(n){b(n)}},v=d=>d.done?_(d.value):Promise.resolve(d.value).then(m,D);v((e=e.apply(c,r)).next())});import{P as V,d as se,n as f,aE as U,D as $,r as u,b as ne,c as w,f as p,e as t,F as N,t as q,a3 as re,g as z,U as ie,j as o,i as A,A as L,w as Z,y as x,h as R,R as C,o as i,v as G,an as de,ao as ue,M as ce,_ as me}from"./index-_ppfBu12.js";import{z as fe}from"./index.esm-BK-uHWKN.js";import{a as pe,b as _e,s as ve,c as we}from"./account-DbMz9lm_.js";import{R as ye,a as be}from"./rule-Dv-Bgzwo.js";const X=V({newPassword:[{required:!0,validator:(c,r,e)=>{r===""?e(new Error("请输入密码")):be.test(r)?e():e(new Error("密码格式必须在6至20个字符之间且不能包含中文"))},trigger:"blur"}],newEmail:[{required:!0,validator:(c,r,e)=>{r===""?e(new Error("请输入邮箱")):ye.test(r)?e():e(new Error("邮箱格式不正确"))},trigger:"blur"}],verificationCode:[{required:!0,validator:(c,r,e)=>{r===""?e(new Error("请输入验证码")):/^\d{6}$/.test(r)?e():e(new Error("验证码为6位（数字）"))},trigger:"blur"}]}),Ee=c=>(de("data-v-c49ab604"),c=c(),ue(),c),ge=Ee(()=>p("h3",{class:"my-8"},"账户管理",-1)),xe={class:"flex items-center"},Ce={class:"flex-1"},ke={class:"flex justify-center my-2"},he={key:0},Ve={key:1},Pe={key:0},Ie={key:1},Te={class:"dialog-footer"},Fe=se({name:"AccountManagement",__name:"AccountManagement",setup(c){const r=f([{title:"账户密码",illustrate:"修改您的账户密码以确保安全",button:"修改"},{title:"绑定邮箱",illustrate:"已绑定邮箱："+U().email,button:"修改"},{title:"绑定手机",illustrate:"已经绑定手机："+U().phone,button:"修改"}]),e=f(!1),_=f(""),b=f(),m=V({newPassword:"",verificationCode:""}),D=[{color:"#e74242",text:"非常弱"},{color:"#EFBD47",text:"弱"},{color:"#ffa500",text:"一般"},{color:"#1bbf1b",text:"强"},{color:"#008000",text:"非常强"}],v=f(),d=f(),n=V({newEmail:"",verificationCode:""}),P=f(!1),I=f(!1),M=f(!1),E=V({timerId:null,countdownTime:0}),g=V({timerId:null,countdownTime:0});function W(a){switch(a.title){case"账户密码":_.value="修改"+a.title,e.value=!0;break;case"绑定邮箱":_.value="修改"+a.title,e.value=!0,M.value=!0;break;case"绑定手机":C("此功能暂未开放",{type:"warning"});break}}function J(){switch(_.value){case"修改账户密码":Q();break;case"修改绑定邮箱":Y();break;case"修改绑定手机":C("此功能暂未开放",{type:"warning"});break}}function K(){return h(this,null,function*(){(yield ve()).code=="H200"&&(E.countdownTime=60,E.timerId=setInterval(()=>{E.countdownTime--,E.countdownTime<=0&&(P.value=!1,clearInterval(E.timerId))},1e3),P.value=!0,C("验证码发送成功",{type:"success"}))})}function O(){return h(this,null,function*(){(yield we(n.newEmail)).code=="H200"&&(g.countdownTime=60,g.timerId=setInterval(()=>{g.countdownTime--,g.countdownTime<=0&&(I.value=!1,clearInterval(g.timerId))},1e3),I.value=!0,C("验证码发送成功",{type:"success"}))})}function Q(){b.value.validate(a=>h(this,null,function*(){a&&(yield pe(m)).code=="H200"&&(C("密码修改成功",{type:"success"}),e.value=!1)}))}function Y(){d.value.validate(a=>h(this,null,function*(){a&&(yield _e(n)).code=="H200"&&(C("邮箱修改成功",{type:"success"}),U().SET_EMAIL(n.newEmail),e.value=!1)}))}function ee(){e.value=!1,b.value.resetFields(),d.value.resetFields()}return $(m,({newPassword:a})=>v.value=ce(a)?-1:fe(a).score),$(n,({newEmail:a})=>{M.value=!/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(a)}),(a,s)=>{const te=u("el-text"),k=u("el-button"),oe=u("el-divider"),T=u("el-input"),F=u("el-form-item"),le=u("ElProgress"),S=u("el-col"),j=u("el-row"),B=u("el-form"),ae=u("el-dialog"),H=ne("optimize");return i(),w("div",null,[p("div",{class:re(["min-w-[180px]",z(ie)()?"max-w-[100%]":"max-w-[70%]"])},[ge,(i(!0),w(N,null,q(r.value,(l,y)=>(i(),w("div",{key:y},[p("div",xe,[p("div",Ce,[p("p",null,x(l.title),1),t(te,{class:"mx-1",type:"info"},{default:o(()=>[R(x(l.illustrate),1)]),_:2},1024)]),t(k,{type:"primary",text:"",onClick:Se=>W(l)},{default:o(()=>[R(x(l.button),1)]),_:2},1032,["onClick"])]),t(oe)]))),128))],2),t(ae,{modelValue:e.value,"onUpdate:modelValue":s[5]||(s[5]=l=>e.value=l),title:_.value,width:"550",top:"5%","before-close":ee,"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[p("div",Te,[t(k,{text:"",bg:"",onClick:s[4]||(s[4]=l=>e.value=!1)},{default:o(()=>[R("取消")]),_:1}),t(k,{text:"",bg:"",type:"primary",onClick:J},{default:o(()=>[R(" 确认 ")]),_:1})])]),default:o(()=>[_.value=="修改账户密码"?(i(),A(B,{key:0,ref_key:"pwdFormRef",ref:b,model:m,rules:z(X)},{default:o(()=>[t(F,{label:"密 码：",prop:"newPassword"},{default:o(()=>[t(T,{modelValue:m.newPassword,"onUpdate:modelValue":s[0]||(s[0]=l=>m.newPassword=l),placeholder:"请输入新密码",clearable:""},null,8,["modelValue"])]),_:1}),p("div",ke,[(i(),w(N,null,q(D,(l,y)=>p("div",{key:y,class:"w-[19vw]",style:G(y!==0?"margin-left: 4px":"")},[t(le,{striped:"","striped-flow":"",duration:v.value===y?6:0,percentage:v.value>=y?100:0,color:l.color,"stroke-width":10,"show-text":!1},null,8,["duration","percentage","color"]),p("p",{class:"text-center",style:G(v.value===y?{color:l.color}:"")},x(l.text),5)],4)),64))]),t(j,null,{default:o(()=>[t(S,{span:18},{default:o(()=>[t(F,{label:"验证码：",prop:"verificationCode"},{default:o(()=>[t(T,{modelValue:m.verificationCode,"onUpdate:modelValue":s[1]||(s[1]=l=>m.verificationCode=l),placeholder:`向${z(U)().email}发送验证码`,clearable:""},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),t(S,{span:6,style:{display:"flex !important","justify-content":"end"}},{default:o(()=>[Z((i(),A(k,{bg:"",text:"",type:"success",disabled:P.value},{default:o(()=>[P.value?(i(),w("span",Ve,x(E.countdownTime)+"s后重新获取",1)):(i(),w("span",he,"获取验证码"))]),_:1},8,["disabled"])),[[H,{event:"click",fn:K,immediate:!0,timeout:5e3}]])]),_:1})]),_:1})]),_:1},8,["model","rules"])):L("",!0),_.value=="修改绑定邮箱"?(i(),A(B,{key:1,ref_key:"emailFormRef",ref:d,model:n,rules:z(X)},{default:o(()=>[t(F,{label:"邮 箱：",prop:"newEmail"},{default:o(()=>[t(T,{modelValue:n.newEmail,"onUpdate:modelValue":s[2]||(s[2]=l=>n.newEmail=l),placeholder:"请输入新邮箱",clearable:""},null,8,["modelValue"])]),_:1}),t(j,null,{default:o(()=>[t(S,{span:18},{default:o(()=>[t(F,{label:"验证码：",prop:"verificationCode"},{default:o(()=>[t(T,{modelValue:n.verificationCode,"onUpdate:modelValue":s[3]||(s[3]=l=>n.verificationCode=l),placeholder:"请输入验证码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(S,{span:6,style:{display:"flex !important","justify-content":"end"}},{default:o(()=>[Z((i(),A(k,{bg:"",text:"",type:"success",disabled:I.value||M.value},{default:o(()=>[I.value?(i(),w("span",Ie,x(g.countdownTime)+"s后重新获取",1)):(i(),w("span",Pe,"获取验证码"))]),_:1},8,["disabled"])),[[H,{event:"click",fn:O,immediate:!0,timeout:5e3}]])]),_:1})]),_:1})]),_:1},8,["model","rules"])):L("",!0)]),_:1},8,["modelValue","title"])])}}}),Me=me(Fe,[["__scopeId","data-v-c49ab604"]]);export{Me as default};
