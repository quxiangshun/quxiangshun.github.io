var d=(a,n,i)=>new Promise((z,f)=>{var b=r=>{try{c(i.next(r))}catch(m){f(m)}},C=r=>{try{c(i.throw(r))}catch(m){f(m)}},c=r=>r.done?z(r.value):Promise.resolve(r.value).then(b,C);c((i=i.apply(a,n)).next())});import{aP as h,aX as v,P as $,n as s,p as ae,q as ne,D as se,e as k,$ as ie,a2 as re,S as N,T as U,U as Y,R as p,h as O,r as oe,M as le}from"./index-_ppfBu12.js";import{_ as ce}from"./form.vue_vue_type_script_setup_true_lang-do4BGmXp.js";import{s as ue}from"./index-CIrz3C_X.js";import{z as de}from"./index.esm-BK-uHWKN.js";import{R as pe}from"./index-BXBqBEfS.js";import{u as fe}from"./upload-52eDm6oR.js";import"./hooks-B99vGHGm.js";const y="/vmVideo",me=a=>h.request("get",v(`${y}/list`),{params:a}),ge=a=>h.request("post",v(`${y}/create`),{data:a}),_=a=>h.request("put",v(`${y}/update`),{data:a}),he=a=>h.request("delete",v(`${y}/delete`),{data:a}),ve=a=>h.request("get",v(`${y}/getDetail/${a}`));function $e(){const{uploadFileByBack:a}=fe(),n=$({total:0,pageSize:10,currentPage:1,background:!0}),i=$({username:"",email:"",status:"",size:n.pageSize,current:n.currentPage}),z=s(),f=s(),b=s([]),C=s(!1),c=s(!0),r=s(!1),m=ae(()=>["!h-[20px]","reset-margin","!text-gray-500","dark:!text-white","dark:hover:!text-primary"]),j=$({password:""}),A=s(),P=s(),S=s(),W=[{label:"视频名称",prop:"videoName",width:150,fixed:"left"},{label:"类型",prop:"type",width:100,fixed:"left"},{label:"分类",prop:"categories",width:170},{label:"发布类型",prop:"publicationFormat",width:160},{label:"合集类型",prop:"collectionType",width:80,cellRenderer:({row:t,props:e})=>k(oe("el-tag"),{size:e.size,type:t.collectionType===0?"info":t.collectionType===1?"primary":"danger",effect:"plain"},{default:()=>[t.gender===0?"未知":t.gender===1?"男":"女"]})},{label:"创建时间",prop:"createTime",minWidth:110,width:120,showOverflowTooltip:!0,formatter:({createTime:t})=>ie(t).format("YYYY-MM-DD HH:mm:ss")},{label:"简介",prop:"description",minWidth:160},{label:"操作",fixed:"right",width:220,slot:"operation"}];function X(t){ue("警告",{contentRenderer:()=>k("p",{style:"text-align: center;margin-bottom:20px"},[O("确认要删除"),k("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[t.username]),O("吗?")]),beforeSure:e=>d(this,null,function*(){(yield he([t.id])).code=="H200"&&p(`已删除"${t.userName}`,{type:"success"}),e(),o()})})}function E(t){n.currentPage=1,n.pageSize=t,o()}function G(t){n.currentPage=t,o()}function J(t){}function o(){return d(this,null,function*(){c.value=!0,i.current=n.currentPage,i.size=n.pageSize;const{code:t,data:e}=yield me(re(i));t=="H200"&&(b.value=e.records,n.total=e.total,n.pageSize=e.size,n.currentPage=e.current),c.value=!1})}const K=t=>{t&&(t.resetFields(),o())};function Q(t="新增",e){var l,g,H,V,F,T,q,I,M,B;const u=s({});N({title:`${t}视频`,props:{formInline:{id:(l=e==null?void 0:e.id)!=null?l:null,username:(g=e==null?void 0:e.username)!=null?g:"",password:(H=e==null?void 0:e.password)!=null?H:"",nickname:(V=e==null?void 0:e.nickname)!=null?V:"",status:(F=e==null?void 0:e.status)!=null?F:0,gender:(T=e==null?void 0:e.gender)!=null?T:0,email:(q=e==null?void 0:e.email)!=null?q:"",phone:(I=e==null?void 0:e.phone)!=null?I:"",intro:(M=e==null?void 0:e.intro)!=null?M:"",birthday:(B=e==null?void 0:e.birthday)!=null?B:null}},width:"40%",top:"5vh",draggable:!0,fullscreen:Y(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>U(ce,{ref:f}),open:w=>d(this,[w],function*({options:R}){if(t!=="新增"){const x=yield ve(e.id);x.code=="H200"&&(u.value=x.data),R.props.formInline.email=u.value.email,R.props.formInline.phone=u.value.phone}}),beforeSure:(R,{options:w})=>{const x=f.value.getRef(),D=w.props.formInline;function L(){p(`您${t}了视频名为${D.username}的这条数据`,{type:"success"}),R(),o()}x.validate(ee=>d(this,null,function*(){ee&&(t==="新增"?(yield ge(D)).code=="H200"&&L():(yield _(D)).code=="H200"&&L())}))}})}function Z(t){N({title:"裁剪、上传头像",width:"40%",closeOnClickModal:!1,fullscreen:Y(),contentRenderer:()=>U(pe,{ref:P,imgSrc:t.avatar,onCropper:e=>{S.value=e}}),beforeSure:e=>{const u=new File([S.value.blob],S.value.info.name,{type:S.value.blob.type});a(u).then(l=>d(this,null,function*(){if(l.code=="H200"){t.avatar=l.data;const g=yield _(t);g.code=="H200"?p("修改成功",{type:"success"}):p(g.message,{type:"error"})}else p(l.message,{type:"error"})})).catch(l=>{p(l.message,{type:"error",duration:3e3})}).finally(()=>{e(),o()})},closeCallBack:()=>P.value.hidePopover()})}return ne(()=>{o()}),se(j,({password:t})=>A.value=le(t)?-1:de(t).score),{form:i,isShow:C,curRow:z,loading:c,columns:W,dataList:b,isLinkage:r,pagination:n,buttonClass:m,onSearch:o,resetForm:K,openDialog:Q,handleDelete:X,handleSizeChange:E,handleCurrentChange:G,handleSelectionChange:J,handleUpload:Z}}export{$e as useVideoList};
