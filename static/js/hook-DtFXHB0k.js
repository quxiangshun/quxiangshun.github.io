var c=(t,u,r)=>new Promise((g,d)=>{var b=n=>{try{m(r.next(n))}catch(i){d(i)}},f=n=>{try{m(r.throw(n))}catch(i){d(i)}},m=n=>n.done?g(n.value):Promise.resolve(n.value).then(b,f);m((r=r.apply(t,u)).next())});import{P as z,n as o,q as _,e as p,$ as A,a2 as q,R as C,h as v,S as E,T as G,U as J,r as K}from"./index-vTRDVSJy.js";import{_ as Q}from"./form.vue_vue_type_script_setup_true_lang-xi6HIDve.js";import{s as D}from"./index-D8NgSwpL.js";import{a as X,d as Z,b as w,u as k}from"./role-CMJwygUR.js";import"./hooks-gvBetFC1.js";function oe(){const t=z({total:0,pageSize:10,currentPage:1,background:!0}),u=z({roleName:"",roleCode:"",status:"",size:t.pageSize,current:t.currentPage}),r=o({roleName:""}),g=o(),d=o([]),b=o(!1),f=o(!0),m=o(!1),n=o({}),i=o(!1),H=[{label:"角色名称",prop:"roleName",width:200,fixed:"left"},{label:"角色编码",prop:"roleCode",width:240,fixed:"left"},{label:"状态",cellRenderer:e=>{var a;return p(K("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=n.value[e.index])==null?void 0:a.loading,modelValue:e.row.status,"onUpdate:modelValue":s=>e.row.status=s,style:"--el-switch-on-color: #13ce66","active-value":0,"inactive-value":1,"active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,onChange:()=>M(e)},null)},minWidth:80},{label:"绑定用户数",prop:"userCount",width:100},{label:"创建时间",prop:"createTime",minWidth:160,formatter:({createTime:e})=>A(e).format("YYYY-MM-DD HH:mm:ss")},{label:"备注",prop:"remark",minWidth:160},{label:"操作",fixed:"right",width:250,slot:"operation"}];function M({row:e,index:a}){D("提示",{contentRenderer:()=>p("p",{style:"text-align: center;margin-bottom:20px"},[v("确认要"),e.status===1?"停用":"启用",p("strong",{style:"color:var(--el-color-warning);margin:0 5px"},[e.roleName]),v("吗?")]),beforeSure:s=>c(this,null,function*(){n.value[a]=Object.assign({},n.value[a],{loading:!0});const h=yield k(e);n.value[a]=Object.assign({},n.value[a],{loading:!1}),h.code=="H200"&&C(`已${e.status===1?"停用":"启用"}${e.roleName}`,{type:"success"}),s(),l()}),closeCallBack:({args:s})=>{(s==null?void 0:s.command)!=="sure"&&(e.status===0?e.status=1:e.status=0)}})}function P(e){D("警告",{contentRenderer:()=>p("p",{style:"text-align: center;margin-bottom:20px"},[v("确认要删除"),p("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.roleName]),v("吗?")]),beforeSure:a=>c(this,null,function*(){(yield Z(e.id)).code=="H200"&&C(`已删除"${e.roleName}`,{type:"success"}),a(),l()})})}function $(e){t.currentPage=1,t.pageSize=e,l()}function F(e){t.currentPage=e,l()}function V(e){}function l(){return c(this,null,function*(){f.value=!0,u.current=t.currentPage,u.size=t.pageSize;const{code:e,data:a}=yield X(q(u));e!="H200"||(d.value=a.records,t.total=a.total,t.pageSize=a.size,t.currentPage=a.current),f.value=!1})}const Y=e=>{e&&(e.resetFields(),l())};function j(e="新增",a){var s,h,y,S,N;E({title:`${e}角色`,props:{formInline:{id:(s=a==null?void 0:a.id)!=null?s:null,roleName:(h=a==null?void 0:a.roleName)!=null?h:"",roleCode:(y=a==null?void 0:a.roleCode)!=null?y:"",status:(S=a==null?void 0:a.status)!=null?S:0,remark:(N=a==null?void 0:a.remark)!=null?N:""}},width:"40%",draggable:!0,fullscreen:J(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>G(Q,{ref:g}),beforeSure:(L,{options:O})=>{const T=g.value.getRef(),R=O.props.formInline;function x(){C(`您${e}了角色名称为${R.roleName}的这条数据`,{type:"success"}),L(),l()}T.validate(U=>c(this,null,function*(){U&&(e==="新增"?(yield w(R)).code=="H200"&&x():(yield k(R)).code=="H200"&&x())}))}})}function B(e){r.value=e,i.value=!0}function I(e){i.value=e}return _(()=>c(this,null,function*(){l()})),{form:u,isShow:b,curRow:r,loading:f,columns:H,dataList:d,isLinkage:m,pagination:t,roleMenuDrawer:i,onSearch:l,resetForm:Y,openDialog:j,handleDelete:P,handleSizeChange:$,handleCurrentChange:F,handleSelectionChange:V,openRoleMenu:B,handleDrawerUpdate:I}}export{oe as useRole};
