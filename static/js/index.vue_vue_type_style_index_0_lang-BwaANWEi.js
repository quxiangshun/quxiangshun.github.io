var Y=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var T=(r,n,l)=>n in r?Y(r,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[n]=l,j=(r,n)=>{for(var l in n||(n={}))te.call(n,l)&&T(r,l,n[l]);if(I)for(var l of I(n))le.call(n,l)&&T(r,l,n[l]);return r},O=(r,n)=>Z(r,ee(n));var k=(r,n,l)=>new Promise((f,c)=>{var t=o=>{try{e(l.next(o))}catch(i){c(i)}},u=o=>{try{e(l.throw(o))}catch(i){c(i)}},e=o=>o.done?f(o.value):Promise.resolve(o.value).then(t,u);e((l=l.apply(r,n)).next())});import{d as H,T as S,b0 as ae,n as p,D as C,q as ne,X as se,G as oe,W as re,r as b,b as de,c as K,o as U,e as h,j as v,f as _,w as ie,g as R,h as A,y as B,bf as ue,bh as ce,R as M}from"./index-_ppfBu12.js";import{g as E,b as pe}from"./types-CUwkQheH.js";import{l as he,a as fe}from"./permission-AUiPXiFU.js";const me=H({name:"ReTreeLine",props:{node:{type:Object,required:!0},data:{type:Array,default:()=>{}},treeData:{type:Array,default:()=>[]},indent:{type:Number,default:16},showLabelLine:{type:Boolean,default:!0}},setup(r,n){const{slots:l}=n;return{getScopedSlot:t=>{if(!t)return null;const u=t.split("||");let e=null;for(let o=0;o<u.length;o++){const i=u[o];e=(l||{})[i]}return e},getSlotValue:(t,u,e=null)=>ae(t)?t(u)||e:t||e}},render(){const r=this.getScopedSlot("default"),n=this.getScopedSlot("node-label"),l=this.getScopedSlot("after-node-label"),f=r?this.getSlotValue(r,{node:this.node,data:this.data}):[n?this.getSlotValue(n,{node:this.node,data:this.data}):S("span",{class:"element-tree-node-label"},this.node.label),this.showLabelLine?S("span",{class:"element-tree-node-label-line"}):null,this.getSlotValue(l,{node:this.node,data:this.data})],c=[];let t=this.node;for(;t;){let e=t.parent;if(t.level===1&&!t.parent){if(!this.treeData||!Array.isArray(this.treeData))throw Error("if you using el-tree-v2 (Virtualized Tree) of element-plus,element-tree-line required data.");e={children:Array.isArray(this.treeData)?this.treeData.map(o=>O(j({},o),{key:o.id})):[],level:0,key:"node-0",parent:null}}if(e){const o=(e.children||e.childNodes).findIndex(i=>(i.key||i.id)===(t.key||t.id));c.unshift(o===(e.children||e.childNodes).length-1)}t=e}const u=[];for(let e=0;e<this.node.level;e++)u.push(S("span",{class:{"element-tree-node-line-ver":!0,"last-node-line":c[e]&&this.node.level-1!==e,"last-node-isLeaf-line":c[e]&&this.node.level-1===e},style:{left:this.indent*e+"px"}}));return S("span",{class:"element-tree-node-label-wrapper"},[f].concat(u).concat([S("span",{class:"element-tree-node-line-hor",style:{width:(this.node.isLeaf?24:8)+"px",left:(this.node.level-1)*this.indent+"px"}})]))}}),ve={style:{height:"100%"}},ye={class:"header"},ge={class:"text-sm"},be={class:"flex justify-between"},Ve=H({name:"SystemRoleMenu",__name:"index",props:{roleMenuDrawer:{type:Boolean,default:!1},roleObj:{type:Object,default:null}},emits:["updateRoleMenuDrawer"],setup(r,{emit:n}){const l=r,f=p(!0),c=p([]),t=p(),u=p(""),e=p(),o=p(500),i=p(!1),w=p(!1),V=p(!1);let L=[];const P={value:"id",title:"title",children:"children",type:"type"},$=n,y=p(l.roleMenuDrawer);C(()=>l.roleMenuDrawer,s=>{y.value=s}),C(y,s=>{$("updateRoleMenuDrawer",s)}),C(w,s=>{s?t.value.setExpandedKeys(L):t.value.setExpandedKeys([])}),C(V,s=>{s?t.value.setCheckedKeys(L):t.value.setCheckedKeys([])}),ne(()=>{se(e,()=>k(this,null,function*(){yield oe(),re(60).then(()=>{o.value=e.value.clientHeight})}))});function q(){return k(this,null,function*(){const{code:s,data:a,message:g}=yield pe();s!="H200"||(L=ue(a,"id"),c.value=ce(a))})}function z(s){return k(this,null,function*(){f.value=!0;const{code:a,data:g,message:x}=yield he(s.id);a!="H200"?M(x,{type:"error"}):(V.value=!1,i.value=!1,t.value.setCheckedKeys(g),f.value=!1,w.value=!0)})}function X(s){t.value.filter(s),s==""&&(w.value=!0)}function F(s,a){return a.title.includes(s)}function G(){}function Q(){return k(this,null,function*(){const s=t.value.getCheckedKeys(),a=t.value.getCheckedNodes(),g=m=>m.parentId?s.includes(m.parentId):!0;if(a.some(m=>!g(m))){M("选择了子节点但没有选择父节点，请修正后再保存",{type:"warning"});return}const{code:N,message:D}=yield fe({roleId:l.roleObj.id,menuIds:s});N!="H200"?M(D,{type:"error"}):(M("分配成功",{type:"success"}),y.value=!1)})}return q(),(s,a)=>{const g=b("el-input"),x=b("el-text"),N=b("el-tree-v2"),D=b("el-button"),m=b("el-checkbox"),W=b("el-drawer"),J=de("loading");return U(),K("div",null,[h(W,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=d=>y.value=d),title:l.roleObj.roleName,direction:"rtl",size:"40%",class:"role-menu-drawer","close-on-click-modal":!1,onOpen:a[6]||(a[6]=d=>z(l.roleObj)),onClosed:G},{footer:v(()=>[_("div",be,[_("div",null,[h(D,{onClick:a[1]||(a[1]=d=>y.value=!1)},{default:v(()=>[A("取消")]),_:1}),h(D,{type:"primary",onClick:Q},{default:v(()=>[A("保存")]),_:1})]),_("div",null,[h(m,{modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=d=>w.value=d),border:"",label:"展开/折叠"},null,8,["modelValue"]),h(m,{modelValue:V.value,"onUpdate:modelValue":a[3]||(a[3]=d=>V.value=d),border:"",label:"全选/全不选"},null,8,["modelValue"]),h(m,{modelValue:i.value,"onUpdate:modelValue":a[4]||(a[4]=d=>i.value=d),border:"",label:"父子联动"},null,8,["modelValue"])])])]),default:v(()=>[_("div",ve,[_("div",ye,[h(g,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=d=>u.value=d),placeholder:"请输入菜单名称（为角色分配菜单后自动分配首页）",style:{width:"70%"},clearable:"",onInput:X},null,8,["modelValue"])]),ie((U(),K("div",{ref_key:"treeContainerRef",ref:e,style:{height:"90%"}},[h(N,{ref_key:"treeRef",ref:t,height:o.value,data:c.value,props:P,"show-checkbox":"",indent:30,"check-strictly":!i.value,"filter-method":F},{default:v(({node:d})=>[h(R(me),{node:d,showLabelLine:!0},{"node-label":v(()=>[_("span",ge,B(d.data.title),1)]),"after-node-label":v(()=>[h(x,{type:R(E)(d.data.type),effect:"plain"},{default:v(()=>[A(B(R(E)(d.data.type,!0)),1)]),_:2},1032,["type"])]),_:2},1032,["node"])]),_:1},8,["height","data","check-strictly"])])),[[J,f.value]])])]),_:1},8,["modelValue","title"])])}}});export{Ve as _};
