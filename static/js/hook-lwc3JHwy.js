var o=(a,r,c)=>new Promise((v,g)=>{var T=l=>{try{n(c.next(l))}catch(y){g(y)}},h=l=>{try{n(c.throw(l))}catch(y){g(y)}},n=l=>l.done?v(l.value):Promise.resolve(l.value).then(T,h);n((c=c.apply(a,r)).next())});import{aP as d,aX as f,P,n as p,q as G,e as u,$ as Q,a2 as q,R as z,h as S,S as X,T as J,U as K,r as A}from"./index-vTRDVSJy.js";import{_ as Z}from"./form.vue_vue_type_script_setup_true_lang-14wAGF7M.js";import{s as B}from"./index-D8NgSwpL.js";import{u as w}from"./hooks-BYC6ewR3.js";import"./hooks-gvBetFC1.js";const m="/sdApp",ee=a=>d.request("post",f(`${m}/create`),{data:a}),te=a=>d.request("get",f(`${m}/list`),{params:a}),ae=a=>d.request("put",f(`${m}/update`),{data:a}),se=a=>d.request("put",f(`${m}/updateStatus`),{data:a}),ne=a=>d.request("delete",f(`${m}/delete/${a}`)),le=a=>d.request("get",f(`${m}/get-ad-image`),{params:a});function de(){const a=P({total:0,pageSize:10,currentPage:1,background:!0}),r=P({name:"/open_api/2/file/material_attributes/list/",accountType:"QIANCHUAN",adIds:"",size:a.pageSize,current:a.currentPage}),c=p(),v=p(),g=p([]),T=p(!1),h=p(!0),n=p({}),{switchStyle:l}=w(),y=[{label:"应用名称",prop:"name",width:150,fixed:"left"},{label:"类型",prop:"type",width:80,cellRenderer:({row:t,props:e})=>u(A("el-tag"),{size:e.size,type:t.type===1?"primary":"danger",effect:"plain"},{default:()=>[t.type===1?"巨量广告":"巨量千川"]})},{label:"角色",prop:"roleType",width:80,cellRenderer:({row:t,props:e})=>u(A("el-tag"),{size:e.size,type:t.roleType===1?"primary":"danger",effect:"plain"},{default:()=>[t.roleType===1?"广告主":"代理商"]})},{label:"App ID",prop:"appId",minWidth:160},{label:"Secret",prop:"secret"},{label:"Access Token",prop:"accessToken"},{label:"状态",cellRenderer:t=>{var e;return u(A("el-switch"),{size:t.props.size==="small"?"small":"default",loading:(e=n.value[t.index])==null?void 0:e.loading,modelValue:t.row.status,"onUpdate:modelValue":s=>t.row.status=s,"active-value":0,"inactive-value":1,"active-text":"正常","inactive-text":"冻结","inline-prompt":!0,style:l.value,onClick:()=>L(t)},null)},minWidth:80},{label:"创建日期",prop:"createTIme",minWidth:110,width:120,showOverflowTooltip:!0,formatter:({createTime:t})=>Q(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:220,slot:"operation"}];function L({row:t,index:e}){B("提示",{contentRenderer:()=>u("p",{style:"text-align: center;margin-bottom:20px"},[S("确认要"),t.status===1?"冻结":"启用",u("strong",{style:"color:var(--el-color-warning);margin:0 5px"},[t.name]),S("吗?")]),beforeSure:s=>o(this,null,function*(){n.value[e]=Object.assign({},n.value[e],{loading:!0});const b=yield se({id:t.id,status:t.status});n.value[e]=Object.assign({},n.value[e],{loading:!1}),b.code=="H200"&&z(`已${t.status===1?"冻结":"启用"}${t.name}`,{type:"success"}),s(),i()}),closeCallBack:({args:s})=>{(s==null?void 0:s.command)!=="sure"&&(t.status===0?t.status=1:t.status=0)}})}function M(t){B("警告",{contentRenderer:()=>u("p",{style:"text-align: center;margin-bottom:20px"},[S("确认要删除"),u("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[t.username]),S("吗?")]),beforeSure:e=>o(this,null,function*(){(yield ne(t.id)).code=="H200"&&z(`已删除"${t.userName}`,{type:"success"}),e(),i()})})}function N(t){a.currentPage=1,a.pageSize=t,i()}function _(t){a.currentPage=t,i()}function i(){return o(this,null,function*(){h.value=!0,r.current=a.currentPage,r.size=a.pageSize;const{code:t,data:e}=yield te(q(r));t=="H200"&&(g.value=e.records,a.total=e.total,a.pageSize=e.size,a.currentPage=e.current),h.value=!1})}const O=t=>{t&&(t.resetFields(),i())};function U(t="新增",e){var s,b,$,I,R,k,x,C;X({title:`${t}千川应用`,props:{formInline:{id:(s=e==null?void 0:e.id)!=null?s:null,name:(b=e==null?void 0:e.name)!=null?b:"",type:($=e==null?void 0:e.type)!=null?$:1,roleType:(I=e==null?void 0:e.roleType)!=null?I:1,appId:(R=e==null?void 0:e.appId)!=null?R:null,secret:(k=e==null?void 0:e.secret)!=null?k:"",accessToken:(x=e==null?void 0:e.accessToken)!=null?x:"",refreshToken:(C=e==null?void 0:e.refreshToken)!=null?C:""}},width:"40%",top:"5vh",draggable:!0,fullscreen:K(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>J(Z,{ref:v}),beforeSure:(Y,{options:j})=>{const E=v.value.getRef(),D=j.props.formInline;function H(){z(`您${t}了千川应用数据`,{type:"success"}),Y(),i()}E.validate(F=>o(this,null,function*(){F&&(t==="新增"?(yield ee(D)).code=="H200"&&H():(yield ae(D)).code=="H200"&&H())}))}})}function V(){return o(this,null,function*(){const t=yield le(q(r));c.value=t})}return G(()=>{i()}),{form:r,isShow:T,loading:h,columns:y,dataList:g,pagination:a,onSearch:i,resetForm:O,openDialog:U,handleDelete:M,handleSizeChange:N,handleCurrentChange:_,testGetImage:V,testResult:c}}export{de as useAppList};
