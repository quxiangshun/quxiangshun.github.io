var g=(t,o,i)=>new Promise((m,c)=>{var p=a=>{try{n(i.next(a))}catch(d){c(d)}},l=a=>{try{n(i.throw(a))}catch(d){c(d)}},n=a=>a.done?m(a.value):Promise.resolve(a.value).then(p,l);n((i=i.apply(t,o)).next())});import{aP as S,aX as T,P as y,n as u,q as E,e as f,$ as b,a2 as L,S as M,R as D,h as w,r as O,aY as N}from"./index-vTRDVSJy.js";import{s as A}from"./index-D8NgSwpL.js";import{D as q,g as $,a as j}from"./detail-DKVr2Foi.js";import"./hooks-gvBetFC1.js";import"./dict-DQTx9lZO.js";import"./dict-rWWMm-MP.js";const v="/sysOperLog",B=t=>S.request("get",T(`${v}/list`),{params:t}),I=t=>S.request("delete",T(`${v}/delete`),{data:t}),_=()=>S.request("delete",T(`${v}/clear`));function U(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!N(t)}function Z(){const t=y({total:0,pageSize:10,currentPage:1,background:!0}),o=y({title:"",status:null,operTimeArr:null,size:t.pageSize,current:t.currentPage}),i=u(!1),m=u(),c=u([]),p=u(!0),l=u(),n=u(0),a=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"日志编号",prop:"id",fixed:"left",showOverflowTooltip:!0},{label:"操作模块",prop:"title"},{label:"操作人员",prop:"operUsername",showOverflowTooltip:!0},{label:"操作地址",prop:"operLocation",showOverflowTooltip:!0},{label:"操作IP",prop:"operIp",showOverflowTooltip:!0},{label:"业务类型",prop:"businessType",showOverflowTooltip:!0,cellRenderer:({row:e})=>{let r;return f(O("el-tag"),{type:"primary"},U(r=$(j.OPER_BUSINESS_TYPE,e.businessType.toString()))?r:{default:()=>[r]})}},{label:"操作状态",prop:"status",showOverflowTooltip:!0,cellRenderer:({row:e})=>f(O("el-tag"),{type:e.status==0?"success":"danger"},{default:()=>[e.status==0?"成功":"失败"]})},{label:"耗时",prop:"costTime",showOverflowTooltip:!0,formatter:({costTime:e})=>`${e}ms`},{label:"操作时间",prop:"operTime",showOverflowTooltip:!0,formatter:({operTime:e})=>b(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:100,slot:"operation"}];function d(e){t.currentPage=1,t.pageSize=e,s()}function R(e){t.currentPage=e,s()}function Y(e){n.value=e.length,l.value.setAdaptive()}function P(){A("警告",{contentRenderer:()=>f("p",{style:"text-align: center;margin-bottom:20px"},[w("确认要清空登录日志吗?")]),beforeSure:e=>g(this,null,function*(){(yield _()).code=="H200"&&D("清空成功",{type:"success"}),e(),s()})})}function x(){const e=l.value.getTableRef().getSelectionRows();A("警告",{contentRenderer:()=>f("p",{style:"text-align: center;margin-bottom:20px"},[w("确认要删除编号为"),e.map((r,h)=>f("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[r.id,h<e.length-1?"、":""])),w("的日志吗?")]),beforeSure:r=>g(this,null,function*(){const h=e.map(C=>C.id);(yield I(h)).code=="H200"&&D("删除成功",{type:"success"}),r(),l.value.getTableRef().clearSelection(),s()})})}function z(){n.value=0,l.value.getTableRef().clearSelection()}function F(e){M({title:"系统操作日志详情",fullscreen:!0,hideFooter:!0,contentRenderer:()=>q,props:{data:e}})}function s(){return g(this,null,function*(){p.value=!0,o.current=t.currentPage,o.size=t.pageSize,o.operTimeArr!==null&&o.operTimeArr.length==2&&(o.operTimeArr[0]=b(o.operTimeArr[0]).format("YYYY-MM-DD HH:mm:ss"),o.operTimeArr[1]=b(o.operTimeArr[1]).format("YYYY-MM-DD HH:mm:ss"));const{code:e,data:r}=yield B(L(o));e=="H200"&&(c.value=r.records,t.total=r.total,t.pageSize=r.size,t.currentPage=r.current),p.value=!1})}const H=e=>{e&&(e.resetFields(),s())};return E(()=>{s()}),{isShow:i,queryForm:o,curRow:m,loading:p,columns:a,dataList:c,pagination:t,selectedNum:n,tableRef:l,onSearch:s,resetForm:H,handlebatchDelete:x,handleSizeChange:d,handleCurrentChange:R,handleSelectionChange:Y,handleClear:P,handleSelectionCancel:z,openDetail:F}}export{Z as useOperLog};
