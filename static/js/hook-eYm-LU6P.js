var r=(t,c,n)=>new Promise((m,l)=>{var k=s=>{try{d(n.next(s))}catch(f){l(f)}},u=s=>{try{d(n.throw(s))}catch(f){l(f)}},d=s=>s.done?m(s.value):Promise.resolve(s.value).then(k,u);d((n=n.apply(t,c)).next())});import{P as x,n as o,q as O,$ as V,a2 as W,e as H,R as P,h as R,S as j,T as q,U as A}from"./index-B7W7rs76.js";import{_ as B}from"./form.vue_vue_type_script_setup_true_lang-ljKZakoG.js";import{s as E}from"./index-B9geSWXR.js";import{a as G,d as J,b as K,u as Q,c as X}from"./task-CvdGstJD.js";import{l as Z}from"./task-column-CVlSAbiS.js";import{t as w}from"./dept-Bawlm6k1.js";import"./hooks-D07EST8v.js";function oe(){const t=x({total:0,pageSize:10,currentPage:1,background:!0}),c=x({username:"",email:"",status:"",size:t.pageSize,current:t.currentPage}),n=o(),m=o([]),l=o([]),k=o(!1),u=o(!0),d=[{label:"任务编号",prop:"id",width:150,fixed:"left"},{label:"下单数量",prop:"count",width:150,fixed:"left"},{label:"公开日期",prop:"publicTime",minWidth:110,width:120,showOverflowTooltip:!0,formatter:({createTime:a})=>V(a).format("YYYY-MM-DD HH:mm:ss")},{label:"简介",prop:"remark",minWidth:160},{label:"操作",fixed:"right",width:220,slot:"operation"}];function s(a){E("警告",{contentRenderer:()=>H("p",{style:"text-align: center;margin-bottom:20px"},[R("确认要删除"),H("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[a.username]),R("吗?")]),beforeSure:e=>r(this,null,function*(){(yield J(a.id)).code=="H200"&&P(`已删除"${a.userName}`,{type:"success"}),e(),i()})})}function f(a){t.currentPage=1,t.pageSize=a,i()}function L(a){t.currentPage=a,i()}function i(){return r(this,null,function*(){u.value=!0,c.current=t.currentPage,c.size=t.pageSize;const{code:a,data:e}=yield G(W(c));a=="H200"&&(m.value=e.records,t.total=e.total,t.pageSize=e.size,t.currentPage=e.current),u.value=!1})}const M=a=>{a&&(a.resetFields(),i())};function Y(a="新增",e){return r(this,null,function*(){var b,v,T,y,S,D,z;const p=o({}),{data:F}=yield w();j({title:`${a}任务`,props:{formInline:{id:(b=e==null?void 0:e.id)!=null?b:null,count:(v=e==null?void 0:e.count)!=null?v:0,type:(T=e==null?void 0:e.type)!=null?T:0,remark:(y=e==null?void 0:e.remark)!=null?y:"",publicTime:(S=e==null?void 0:e.publicTime)!=null?S:null,users:F,userIds:(D=e==null?void 0:e.userIds)!=null?D:[],taskColumns:l.value,columns:(z=e==null?void 0:e.columns)!=null?z:[]}},width:"40%",top:"5vh",draggable:!0,fullscreen:A(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>q(B,{ref:n}),open:N=>r(this,[N],function*({options:g}){if(a!=="新增"){const h=yield X(e.id);h.code=="H200"&&(p.value=h.data),g.props.formInline.columns=p.value.columns,g.props.formInline.userIds=p.value.userIds}}),beforeSure:(g,{options:N})=>{const h=n.value.getRef(),C=N.props.formInline;function I(){P(`您${a}了任务数据`,{type:"success"}),g(),i()}h.validate(U=>r(this,null,function*(){U&&(a==="新增"?(yield K(C)).code=="H200"&&I():(yield Q(C)).code=="H200"&&I())}))}})})}function $(){return r(this,null,function*(){const{code:a,data:e}=yield Z();a=="H200"&&(l.value=e)})}return O(()=>{$(),i()}),{form:c,isShow:k,loading:u,columns:d,dataList:m,pagination:t,onSearch:i,resetForm:M,openDialog:Y,handleDelete:s,handleSizeChange:f,handleCurrentChange:L}}export{oe as useTaskList};
