var n=(u,C,b)=>new Promise((y,c)=>{var v=s=>{try{o(b.next(s))}catch(p){c(p)}},f=s=>{try{o(b.throw(s))}catch(p){c(p)}},o=s=>s.done?y(s.value):Promise.resolve(s.value).then(v,f);o((b=b.apply(u,C)).next())});import{_ as oe}from"./categoryForm.vue_vue_type_script_setup_true_lang-CYlhHkO1.js";import{_ as se}from"./categoryLabelForm.vue_vue_type_script_setup_true_lang-Bk7xPbIM.js";import{n as r,e as t,G as T,R as m,h as d,S as j,T as h,U as w,F as z,aE as U,r as M}from"./index-B7W7rs76.js";import{u as P}from"./hooks-D07EST8v.js";import{l as ie,d as N,e as W,f as re,g as ue,h as ce,b as de,u as G,i as ve}from"./category-DZVAWecF.js";import{s as x}from"./index-B9geSWXR.js";import{u as fe}from"./hooks-lRjJeveP.js";import{e as ge}from"./label-DekmD-EQ.js";import"./index-By3I6NGF.js";import"./rule-DiMNR7bg.js";function ke(u=1){const C=r(),b=r(),y=r([]),c=r([]),v=r([]),f=r(null),o=r(null),s=r(),p=r(!0),i=r({}),{switchStyle:F}=fe(),q=[{label:"分类名称",prop:"name",align:"left",cellRenderer:({row:e})=>t(z,null,[t("span",{class:"inline-block mr-1"},[h(P(e.icon),{style:{paddingTop:"1px"}})]),t("span",null,[e.name])])},{label:"状态",cellRenderer:e=>{var a;return t(M("el-switch"),{disabled:U().isSelf(e.row.id)&&e.row.visible===0,size:e.props.size==="small"?"small":"default",loading:(a=i.value[e.index])==null?void 0:a.loading,modelValue:e.row.visible,"onUpdate:modelValue":l=>e.row.visible=l,"active-value":0,"inactive-value":1,"active-text":"正常","inactive-text":"冻结","inline-prompt":!0,style:F.value,onClick:()=>J(e)},null)},minWidth:60},{label:"操作",fixed:"right",width:80,slot:"operation"}];function J({row:e,index:a}){x("提示",{contentRenderer:()=>t("p",{style:"text-align: center;margin-bottom:20px"},[d("确认要"),e.visible===1?"禁用":"启用",t("strong",{style:"color:var(--el-color-warning);margin:0 5px"},[e.name]),d("吗?")]),beforeSure:l=>n(this,null,function*(){i.value[a]=Object.assign({},i.value[a],{loading:!0});const g=yield G({id:e.id,visible:e.visible});i.value[a]=Object.assign({},i.value[a],{loading:!1}),g.code=="H200"&&m(`已${e.visible===1?"禁用":"启用"}${e.name}`,{type:"success"}),l()}),closeCallBack:({args:l})=>{(l==null?void 0:l.command)!=="sure"&&(e.visible===0?e.visible=1:e.visible=0)}})}const K=[{label:"标签名称",prop:"name",align:"left",cellRenderer:({row:e})=>t(z,null,[t("span",{class:"inline-block mr-1"},[h(P(e.icon),{style:{paddingTop:"1px"}})]),t("span",null,[e.name])])},{label:"必填",cellRenderer:e=>{var a;return t(M("el-switch"),{disabled:U().isSelf(e.row.id)&&e.row.visible===0,size:e.props.size==="small"?"small":"default",loading:(a=i.value[e.index])==null?void 0:a.loading,modelValue:e.row.visible,"onUpdate:modelValue":l=>e.row.visible=l,"active-value":0,"inactive-value":1,"active-text":"正常","inactive-text":"冻结","inline-prompt":!0,style:F.value,onClick:()=>Q(e)},null)},minWidth:60},{label:"操作",fixed:"right",width:60,slot:"operation"}];function Q({row:e,index:a}){x("提示",{contentRenderer:()=>t("p",{style:"text-align: center;margin-bottom:20px"},[d("确认要"),e.visible===1?"非必填":"必填",t("strong",{style:"color:var(--el-color-warning);margin:0 5px"},[e.name]),d("吗?")]),beforeSure:l=>n(this,null,function*(){i.value[a]=Object.assign({},i.value[a],{loading:!0});const g=yield ve({labelId:e.id,categoryId:o.value.id,visible:e.visible});i.value[a]=Object.assign({},i.value[a],{loading:!1}),g.code=="H200"&&m(`${e.name}已${e.visible===1?"设置非必填":"设置必填"}`,{type:"success"}),l()}),closeCallBack:({args:l})=>{(l==null?void 0:l.command)!=="sure"&&(e.visible===0?e.visible=1:e.visible=0)}})}function X(e="新增",a,l=0){var L,R;let g=u,A="";l==1?(g=f.value.id,A=`（父级分类：${f.value.name}）`):l==2&&(g=a.parentId),j({title:`${e}分类${A}`,props:{formInline:{id:(L=a==null?void 0:a.id)!=null?L:null,parentId:g,rootId:u,type:u,name:(R=a==null?void 0:a.name)!=null?R:""}},width:"55%",top:"2%",draggable:!0,fullscreen:w(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>h(oe,{ref:s}),beforeSure:(V,Fe)=>n(this,[V,Fe],function*(I,{options:k}){const te=s.value.getRef(),$=k.props.formInline;function _(){m(`${e}分类：${$.name}成功`,{type:"success"}),I(),e.indexOf("二级")!=-1?S():B(u)}te.validate(ne=>n(this,null,function*(){if(ne)try{e.indexOf("新增")!=-1?(yield de($)).code=="H200"&&_():(yield G($)).code=="H200"&&_()}catch(E){console.error("Error update menu:",E),m(`${e}分类时出错`,{type:"error"})}}))})})}function Y(){return n(this,null,function*(){const{data:e}=yield ge();j({title:"添加关联",props:{formInline:{labels:e,categoryId:o.value.id,categoryRootId:u}},width:"55%",top:"2%",draggable:!0,fullscreen:w(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>h(se,{ref:s}),beforeSure:(g,A)=>n(this,[g,A],function*(a,{options:l}){const L=s.value.getRef(),R=l.props.formInline;function I(){m("关联标签成功",{type:"success"}),a(),D()}L.validate(k=>n(this,null,function*(){if(k)try{(yield ce(R)).code=="H200"&&I()}catch(V){console.error("Error update menu:",V),m("关联标签时出错",{type:"error"})}}))})})})}function B(e){return n(this,null,function*(){const{data:a}=yield ie(e||u);y.value=a.level1Categories,c.value=a.level2Categories,v.value=a.level2CategoryLabels})}function S(){return n(this,null,function*(){const{data:e}=yield W(f.value.id);c.value=e.level2Categories,v.value=e.level2CategoryLabels})}function D(){return n(this,null,function*(){const{data:e}=yield N(o.value.id);v.value=e.level2CategoryLabels})}function Z(e,a=""){x("警告",{contentRenderer:()=>t("p",{style:"text-align: center;margin-bottom:20px"},[d("确认要删除"),t("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.name]),d("吗？此分类的子分类也会被删除")]),beforeSure:l=>n(this,null,function*(){(yield ue(e.id)).code=="H200"&&m(`已删除"${e.name}`,{type:"success"}),l(),a.indexOf("二级")?S():B(u)})})}function ee(e){x("警告",{contentRenderer:()=>t("p",{style:"text-align: center;margin-bottom:20px"},[d("确认要删除"),t("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[o.value.name]),d("和"),t("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[e.name]),d("吗？")]),beforeSure:a=>n(this,null,function*(){(yield re(o.value.id,e.id)).code=="H200"&&m(`已删除"${e.name}的关联数据`,{type:"success"}),a(),D()})})}function ae(e){T(()=>n(this,null,function*(){f.value=e;const{data:a}=yield W(e.id);c.value=a.level2Categories,v.value=a.level2CategoryLabels,O()}))}function le(e){T(()=>n(this,null,function*(){o.value=e;const{data:a}=yield N(e.id);v.value=a.level2CategoryLabels,H()}))}function H(){const{setCurrentRow:e}=C.value.getTableRef();y.value&&(f.value=y.value[0],e(f.value))}function O(){const{setCurrentRow:e}=b.value.getTableRef();c.value&&(o.value=c.value[0],e(o.value))}return setTimeout(()=>{H(),O()},50),{singleLevel1CategoryTableRef:C,singleLevel2CategoryTableRef:b,categoryColumns:q,labelColumns:K,openCategoryDialog:X,openCategoryLabelDialog:Y,handleDeleteCategory:Z,handleDeleteCategoryLabel:ee,level1CategoryList:y,level2CategoryList:c,level2CategoryLabelList:v,clickLevel1Row:ae,clickLevel2Row:le,reloadLevel1Category:B,loading:p}}export{ke as useTabPane};
