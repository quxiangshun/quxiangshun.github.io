var F=($,P,g)=>new Promise((h,e)=>{var I=c=>{try{C(g.next(c))}catch(u){e(u)}},L=c=>{try{C(g.throw(c))}catch(u){e(u)}},C=c=>c.done?h(c.value):Promise.resolve(c.value).then(I,L);C((g=g.apply($,P)).next())});import{d as se,n as v,P as re,r,i as O,o as i,j as a,e as l,g as p,c as _,F as k,t as V,h as f,y as x,f as A,B as ue,R as M,G as D,_ as ie}from"./index-vTRDVSJy.js";import{R as m}from"./index-_Th1-riL.js";import{t as ce,g as fe,s as T}from"./label-B_Trvi3_.js";import{d as pe}from"./close-line-Dw4sg3MD.js";import{a as _e,u as me}from"./script-B9vkcQ9t.js";const ve={class:"list-border"},ge=["onClick"],ye={class:"list-border"},be=["onClick"],Ie={class:"list-border"},Ce=se({__name:"form.bak",props:{formAttrProp:{default:()=>({name:"",depts:[],tasks:[],categoryOptions:[]})}},setup($){const P=$,g=v(P.formAttrProp),h=v(),e=re({type:7,categories:[0,0],level1CategoryId:0,level2CategoryId:0,name:"",taskId:null,labelIds:[],userIds:[],protectionPeriod:"",notice:""}),I=v(P.formAttrProp.categoryOptions),L=v([]),C=v([]),c=v([]),u=v([]),j=n=>{n&&n.validate(t=>F(this,null,function*(){if(t){let d=function(){M(`您${w}了脚本数据`,{type:"success"})};const s={level1CategoryId:e.level1CategoryId,level2CategoryId:e.level2CategoryId,name:e.name,taskId:e.taskId,labelIds:e.labelIds,userIds:e.userIds},w=e.name;w!=="新增"?(yield _e(s)).code=="H200"&&d():(yield me(s)).code=="H200"&&d()}else return!1}))},q=n=>{n&&n.resetFields()},R=v([]);function z(){const n=e.categories;if(e.level1CategoryId!=n[0]&&e.level2CategoryId!=n[1]){e.level1CategoryId=n[0],e.level2CategoryId=n[1];const t=I.value.filter(d=>d.id==e.categories[0]);R.value=t&&t[0].children||[],G()}}function J(){const n=e.categories;if(e.level1CategoryId!=n[0]){e.categories[0]=e.level1CategoryId;const t=I.value.filter(d=>d.id==e.categories[0]);R.value=t&&t[0].children||[]}}function K(){const n=e.categories;e.level2CategoryId!=n[1]&&(e.categories[0]=e.level1CategoryId,e.categories[1]=e.level2CategoryId,u.value=[],e.labelIds=[],G())}function Q(){if(!(e.level1CategoryId&&e.level2CategoryId)){M("请先选择一/二级分类",{type:"warning"});return}}function G(){return F(this,null,function*(){const{data:n}=yield ce(e.level2CategoryId);L.value=n;const{data:t}=yield fe(e.level2CategoryId);if(t&&t.length>0){C.value=t;const{data:d}=yield T(t[0].id);c.value=d}})}function W(n){return F(this,null,function*(){const{data:t}=yield T(n);c.value=t})}function X(){D(()=>{const n=c.value.filter(t=>{const d=t.id;return e.labelIds.includes(d)});u.value=n})}function Z(n){D(()=>{const t=u.value||[];t.findIndex(s=>s.id===n.id)>-1?u.value=t.filter(s=>s.id!==n.id):u.value=[...t,n],e.labelIds=u.value.map(s=>s.id)})}function E(n){D(()=>{const t=u.value||[];u.value=t.filter(d=>d.id!==n.id),e.labelIds=u.value.map(d=>d.id)})}return(n,t)=>{const d=r("el-cascader"),s=r("el-form-item"),w=r("el-radio"),U=r("el-radio-group"),y=r("el-row"),H=r("el-input"),ee=r("el-option"),le=r("el-select"),b=r("el-text"),S=r("el-card"),B=r("el-col"),ae=r("el-checkbox"),te=r("el-checkbox-group"),oe=r("IconifyIconOffline"),ne=r("el-date-picker"),N=r("el-button"),de=r("el-form");return i(),O(de,{ref_key:"formRef",ref:h,model:e,"label-width":"130px"},{default:a(()=>[l(y,null,{default:a(()=>[l(p(m),null,{default:a(()=>[l(s,{label:"脚本分类："},{default:a(()=>[l(d,{modelValue:e.categories,"onUpdate:modelValue":t[0]||(t[0]=o=>e.categories=o),class:"!w-full",placeholder:"请选择脚本分类",options:I.value,props:{value:"id",label:"name",children:"children"},filterable:"",clearable:"",onChange:z},null,8,["modelValue","options"])]),_:1})]),_:1}),l(p(m),null,{default:a(()=>[l(s,{label:"一级分类"},{default:a(()=>[l(U,{modelValue:e.level1CategoryId,"onUpdate:modelValue":t[1]||(t[1]=o=>e.level1CategoryId=o),onChange:J},{default:a(()=>[(i(!0),_(k,null,V(I.value,o=>(i(),O(w,{key:o.id,value:o.id},{default:a(()=>[f(x(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(p(m),null,{default:a(()=>[l(s,{label:"二级分类"},{default:a(()=>[l(U,{modelValue:e.level2CategoryId,"onUpdate:modelValue":t[2]||(t[2]=o=>e.level2CategoryId=o),onChange:K},{default:a(()=>[(i(!0),_(k,null,V(R.value,o=>(i(),O(w,{key:o.id,value:o.id},{default:a(()=>[f(x(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:a(()=>[l(p(m),null,{default:a(()=>[l(s,{label:"脚本名称：",prop:"videoName"},{default:a(()=>[l(H,{modelValue:e.name,"onUpdate:modelValue":t[3]||(t[3]=o=>e.name=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:a(()=>[l(p(m),null,{default:a(()=>[l(s,{label:"关联任务："},{default:a(()=>[l(le,{modelValue:e.taskId,"onUpdate:modelValue":t[4]||(t[4]=o=>e.taskId=o)},{default:a(()=>[(i(!0),_(k,null,V(g.value.tasks,o=>(i(),O(ee,{key:o.id,value:o.id,label:o.id},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(y,null,{default:a(()=>[l(p(m),null,{default:a(()=>[l(s,{label:"公共标签："},{default:a(()=>[l(d,{modelValue:e.labelIds,"onUpdate:modelValue":t[5]||(t[5]=o=>e.labelIds=o),placeholder:"请选择公共标签",options:L.value,props:{value:"id",label:"name",children:"children",multiple:!0,emitPath:!1},"show-all-levels":!1,"collapse-tags":"",filterable:"",clearable:"",style:{width:"240px"},onFocus:Q,onChange:X},null,8,["modelValue","options"])]),_:1})]),_:1}),l(p(m),null,{default:a(()=>[l(s,null,{default:a(()=>[l(y,{style:{width:"100%"}},{default:a(()=>[l(B,{span:6},{default:a(()=>[A("div",ve,[l(S,{class:"list-container"},{header:a(()=>[l(b,null,{default:a(()=>[f("标签组")]),_:1})]),default:a(()=>[(i(!0),_(k,null,V(C.value,o=>(i(),_("div",{key:o.id,class:"el-list-item",onClick:Y=>W(o.id)},[l(b,null,{default:a(()=>[f(x(o.name),1)]),_:2},1024)],8,ge))),128))]),_:1})])]),_:1}),l(B,{span:6},{default:a(()=>[A("div",ye,[l(S,{class:"list-container"},{header:a(()=>[l(b,null,{default:a(()=>[f("子标签")]),_:1})]),default:a(()=>[l(te,{modelValue:e.labelIds,"onUpdate:modelValue":t[6]||(t[6]=o=>e.labelIds=o)},{default:a(()=>[(i(!0),_(k,null,V(c.value,o=>(i(),_("div",{key:o.id,class:"el-list-item",onClick:ue(Y=>Z(o),["prevent"])},[l(ae,{value:o.id},null,8,["value"]),l(b,null,{default:a(()=>[f(x(o.name),1)]),_:2},1024)],8,be))),128))]),_:1},8,["modelValue"])]),_:1})])]),_:1}),l(B,{span:6},{default:a(()=>[A("div",Ie,[l(S,{class:"list-container"},{header:a(()=>[l(b,null,{default:a(()=>[f("已添加标签")]),_:1})]),default:a(()=>[(i(!0),_(k,null,V(u.value,o=>(i(),_("div",{key:o.id,class:"el-list-item"},[l(b,null,{default:a(()=>[f(x(o.name),1)]),_:2},1024),l(oe,{icon:p(pe),onClick:Y=>E(o)},null,8,["icon","onClick"])]))),128))]),_:1})])]),_:1}),l(B,{span:6})]),_:1})]),_:1})]),_:1})]),_:1}),l(y,null,{default:a(()=>[l(p(m),null,{default:a(()=>[l(s,{label:"保护期：",prop:"protectionPeriod"},{default:a(()=>[l(ne,{modelValue:e.protectionPeriod,"onUpdate:modelValue":t[7]||(t[7]=o=>e.protectionPeriod=o),type:"datetime",class:"!w-[200px]",placeholder:"请选择保护期","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"]),f(" 到设定日期后，所有人可查看 ")]),_:1})]),_:1})]),_:1}),l(y,null,{default:a(()=>[l(p(m),null,{default:a(()=>[l(s,{label:"提醒谁看："},{default:a(()=>[l(d,{modelValue:e.userIds,"onUpdate:modelValue":t[8]||(t[8]=o=>e.userIds=o),placeholder:"请选择人员",options:g.value.depts,props:{value:"id",label:"name",children:"children",multiple:!0,emitPath:!1},"show-all-levels":!1,"collapse-tags":"",filterable:"",clearable:"",style:{width:"240px"}},null,8,["modelValue","options"]),l(b,null,{default:a(()=>[f("并发送消息")]),_:1}),l(H,{modelValue:e.notice,"onUpdate:modelValue":t[9]||(t[9]=o=>e.notice=o),style:{width:"300px"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(s,null,{default:a(()=>[l(N,{type:"primary",text:"",bg:"",onClick:t[10]||(t[10]=o=>j(h.value))},{default:a(()=>[f(" 提交 ")]),_:1}),l(N,{text:"",bg:"",onClick:t[11]||(t[11]=o=>q(h.value))},{default:a(()=>[f("重置")]),_:1})]),_:1})]),_:1},8,["model"])}}}),Le=ie(Ce,[["__scopeId","data-v-97f3470a"]]);export{Le as default};
