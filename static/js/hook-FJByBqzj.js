var d=(t,o,u)=>new Promise((m,c)=>{var g=r=>{try{l(u.next(r))}catch(p){c(p)}},n=r=>{try{l(u.throw(r))}catch(p){c(p)}},l=r=>r.done?m(r.value):Promise.resolve(r.value).then(g,n);l((u=u.apply(t,o)).next())});import{aP as v,aX as T,P as A,n as i,q as F,e as f,$ as w,a2 as O,R as y,h as b,r as C}from"./index-vTRDVSJy.js";import{s as L}from"./index-D8NgSwpL.js";import"./hooks-gvBetFC1.js";const S="/sysLoginLog",M=t=>v.request("get",T(`${S}/list`),{params:t}),q=t=>v.request("delete",T(`${S}/delete`),{data:t}),E=()=>v.request("delete",T(`${S}/clear`));function j(){const t=A({total:0,pageSize:10,currentPage:1,background:!0}),o=A({account:"",status:null,loginTimeArr:null,size:t.pageSize,current:t.currentPage}),u=i(!1),m=i(),c=i([]),g=i(!0),n=i(),l=i(0),r=[{label:"勾选列",type:"selection",fixed:"left",reserveSelection:!0},{label:"日志编号",prop:"id",fixed:"left",showOverflowTooltip:!0},{label:"用户账号",prop:"account"},{label:"IP地址",prop:"ipAddress",showOverflowTooltip:!0},{label:"登录地点",prop:"loginLocation",showOverflowTooltip:!0},{label:"操作系统",prop:"os",showOverflowTooltip:!0},{label:"浏览器",prop:"browser",showOverflowTooltip:!0},{label:"登录状态",prop:"status",showOverflowTooltip:!0,cellRenderer:({row:e})=>f(C("el-tag"),{type:e.status==0?"success":"danger"},{default:()=>[e.status==0?"成功":"失败"]})},{label:"登录信息",prop:"msg",showOverflowTooltip:!0},{label:"登录时间",prop:"loginTime",showOverflowTooltip:!0,formatter:({loginTime:e})=>w(e).format("YYYY-MM-DD HH:mm:ss")}];function p(e){t.currentPage=1,t.pageSize=e,s()}function Y(e){t.currentPage=e,s()}function R(e){l.value=e.length,n.value.setAdaptive()}function D(){L("警告",{contentRenderer:()=>f("p",{style:"text-align: center;margin-bottom:20px"},[b("确认要清空登录日志吗?")]),beforeSure:e=>d(this,null,function*(){(yield E()).code=="H200"&&y("清空成功",{type:"success"}),e(),s()})})}function x(){const e=n.value.getTableRef().getSelectionRows();L("警告",{contentRenderer:()=>f("p",{style:"text-align: center;margin-bottom:20px"},[b("确认要删除编号为"),e.map((a,h)=>f("strong",{style:"color:var(--el-color-danger);margin:0 5px"},[a.id,h<e.length-1?"、":""])),b("的日志吗?")]),beforeSure:a=>d(this,null,function*(){const h=e.map(P=>P.id);(yield q(h)).code=="H200"&&y("删除成功",{type:"success"}),a(),n.value.getTableRef().clearSelection(),s()})})}function z(){l.value=0,n.value.getTableRef().clearSelection()}function s(){return d(this,null,function*(){g.value=!0,o.current=t.currentPage,o.size=t.pageSize,o.loginTimeArr!==null&&o.loginTimeArr.length==2&&(o.loginTimeArr[0]=w(o.loginTimeArr[0]).format("YYYY-MM-DD HH:mm:ss"),o.loginTimeArr[1]=w(o.loginTimeArr[1]).format("YYYY-MM-DD HH:mm:ss"));const{code:e,data:a}=yield M(O(o));e=="H200"&&(c.value=a.records,t.total=a.total,t.pageSize=a.size,t.currentPage=a.current),g.value=!1})}const H=e=>{e&&(e.resetFields(),s())};return F(()=>{s()}),{isShow:u,queryForm:o,curRow:m,loading:g,columns:r,dataList:c,pagination:t,selectedNum:l,tableRef:n,onSearch:s,resetForm:H,handlebatchDelete:x,handleSizeChange:p,handleCurrentChange:Y,handleSelectionChange:R,handleClear:D,handleSelectionCancel:z}}export{j as useLoginLog};
